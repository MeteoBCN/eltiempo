<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiempo Barcelona</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/weather-icons@1.3.2/css/weather-icons.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-primary: #3B82F6;
            --color-bg-card: rgba(255, 255, 255, 0.85);
            --color-text-primary: #1E293B;
            --color-text-secondary: #64748B;
            --color-text-tertiary: #94A3B8;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --border-radius: 16px;
            --border-radius-sm: 12px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: var(--color-text-primary);
            background: #FFFFFF;
            background-attachment: fixed;
            padding: 0;
            max-width: 600px;
            margin: 0 auto;
            min-height: 100vh;
            font-weight: 400;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
        }
        .container { padding: 0; animation: fadeIn 0.6s ease-out; max-width: 100%; overflow-x: hidden; }
        .header-section {
            background: #2C3E50;
            padding: 0;
            background-image: url('banerf1.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
            min-height: 300px;
        }
        .header-section::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: transparent; z-index: 0; }
        .content-section { background: #FFFFFF; padding: 24px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        .current-weather { text-align: center; padding: 48px 24px 32px 24px; margin-bottom: 32px; background: transparent; border-radius: var(--border-radius); box-shadow: none; backdrop-filter: none; animation: scaleIn 0.6s ease-out 0.2s both; }
        @keyframes scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .weather-divider { height: 1px; background: linear-gradient(90deg, transparent 0%, var(--color-text-tertiary) 50%, transparent 100%); opacity: 0.3; margin: 32px 0 24px 0; }
        .location { font-size: 18px; margin-bottom: 12px; font-weight: 500; color: var(--color-text-secondary); letter-spacing: 0.5px; }
        .icon-large { font-size: 72px; margin: 24px 0; filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1)); }
        .temperature { font-size: 72px; font-weight: 300; margin-bottom: 12px; color: var(--color-text-primary); letter-spacing: -2px; line-height: 1; }
        .condition { font-size: 22px; margin-bottom: 28px; font-weight: 400; color: var(--color-text-secondary); letter-spacing: 0.3px; }
        .details { display: flex; justify-content: space-around; font-size: 14px; margin-top: 28px; flex-wrap: wrap; gap: 24px; }
        .detail-item { text-align: center; min-width: 90px; }
        .detail-item > div:first-child { color: var(--color-text-tertiary); font-size: 11px; text-transform: uppercase; letter-spacing: 0.8px; font-weight: 600; margin-bottom: 6px; }
        .detail-value { font-size: 16px; font-weight: 600; margin-top: 6px; color: var(--color-text-primary); }
        .weather-alerts-banner { margin: 24px 0; padding: 0; animation: fadeIn 0.6s ease-out 0.4s both; }
        .alert-banner-item { padding: 16px 18px; border-left: 4px solid; display: flex; align-items: center; justify-content: space-between; gap: 14px; margin-bottom: 10px; background: transparent; border-radius: 0 var(--border-radius-sm) var(--border-radius-sm) 0; box-shadow: none; }
        .alert-banner-item:last-child { margin-bottom: 0; }
        .alert-banner-green { border-left-color: #10B981; }
        .alert-banner-yellow { border-left-color: #F59E0B; }
        .alert-banner-orange { border-left-color: #F97316; }
        .alert-banner-red { border-left-color: #EF4444; }
        .alert-banner-left { display: flex; align-items: center; gap: 12px; flex: 1; }
        .alert-banner-icon { font-size: 24px; flex-shrink: 0; animation: pulse 2s ease-in-out infinite; }
        .alert-banner-text { flex: 1; }
        .alert-banner-title { font-size: 15px; font-weight: 600; color: var(--color-text-primary); margin-bottom: 3px; letter-spacing: 0.2px; }
        .alert-banner-desc { font-size: 13px; color: var(--color-text-secondary); line-height: 1.4; }
        .alert-banner-level { padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.6px; white-space: nowrap; flex-shrink: 0; }
        .banner-level-green { background-color: #10B981; color: white; }
        .banner-level-yellow { background-color: #F59E0B; color: white; }
        .banner-level-orange { background-color: #F97316; color: white; }
        .banner-level-red { background-color: #EF4444; color: white; }
        .no-alerts-banner { padding: 16px 18px; text-align: center; color: #10B981; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 10px; background: transparent; border-radius: var(--border-radius-sm); box-shadow: none; font-weight: 500; }
        .no-alerts-banner-icon { width: 20px; height: 20px; background-color: #10B981; border-radius: 50%; display: inline-block; animation: pulse 2s ease-in-out infinite; }
        .alerts-banner-loading { padding: 16px 18px; text-align: center; color: var(--color-text-tertiary); font-size: 13px; display: flex; align-items: center; justify-content: center; gap: 10px; background: transparent; border-radius: var(--border-radius-sm); box-shadow: none; }
        .daily-forecast { margin-bottom: 40px; }
        .day-item { display: flex; align-items: center; justify-content: space-between; padding: 20px 0; border-bottom: 1px solid rgba(0, 0, 0, 0.1); }
        .day-item:last-child { border-bottom: none; }
        .day-name { flex: 1; font-size: 18px; color: var(--color-text-primary); }
        .day-icon { font-size: 40px; margin: 0 15px; }
        .day-temps { display: flex; gap: 10px; font-size: 18px; }
        .temp-max { font-weight: 600; color: #EF4444; }
        .temp-min { font-weight: 500; color: #3B82F6; }
        .radar { margin-bottom: 40px; }
        .radar-frame { width: 100%; height: 400px; background: #d0d0d0; border-radius: var(--border-radius); overflow: hidden; }
        .radar-frame iframe { width: 100%; height: 100%; border: none; }
        .update-time { text-align: center; font-size: 13px; color: var(--color-text-tertiary); margin-top: 36px; padding-bottom: 12px; font-weight: 500; letter-spacing: 0.3px; }
        .divulgacion-link { text-align: center; padding: 24px 0 36px; }
        .divulgacion-link a { color: var(--color-text-secondary); text-decoration: none; font-size: 15px; font-weight: 500; border-bottom: 2px solid transparent; transition: all 0.3s ease; letter-spacing: 0.3px; padding-bottom: 2px; }
        .divulgacion-link a:hover { border-bottom-color: var(--color-primary); color: var(--color-primary); }
        .loading { text-align: center; padding: 40px; color: var(--color-text-tertiary); }
        .error { text-align: center; padding: 20px; color: #EF4444; }
        .wi-day-sunny, .wi-night-clear, .wi-day-sunny-overcast, .wi-mostly-clear-day,
        .wi-night-alt-cloudy, .wi-day-cloudy, .wi-cloudy, .wi-fog, .wi-night-fog,
        .wi-sprinkle, .wi-night-alt-sprinkle, .wi-rain, .wi-night-alt-rain,
        .wi-rain-wind, .wi-night-alt-rain-wind, .wi-snow, .wi-night-alt-snow,
        .wi-snow-wind, .wi-night-alt-snow-wind, .wi-showers, .wi-night-alt-showers,
        .wi-storm-showers, .wi-night-alt-storm-showers, .wi-thunderstorm,
        .wi-night-alt-thunderstorm, .wi-raindrop { color: #2C3E50; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .weather-table-container { margin: 40px auto; overflow-x: auto; animation: fadeIn 0.6s ease-out 0.6s both; max-width: 600px; width: 100%; -webkit-overflow-scrolling: touch; }
        #weather-table { width: 100%; min-width: 100%; border-collapse: collapse; background: var(--color-bg-card); border-radius: 0; overflow: hidden; box-shadow: var(--shadow-md); backdrop-filter: blur(10px); }
        #weather-table thead tr { background: #2C3E50; }
        #weather-table thead tr.rain-header-bg { background: url('ff.jpg') center/cover no-repeat !important; }
        #weather-table th { padding: 14px 10px; text-align: center; color: #FFFFFF; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; }
        #weather-table tbody tr { border-bottom: 1px solid rgba(148, 163, 184, 0.15); }
        #weather-table tbody tr:nth-child(even) { background-color: rgba(241, 245, 249, 0.5); }
        #weather-table tbody tr:nth-child(odd) { background-color: rgba(255, 255, 255, 0.3); }
        #weather-table tbody tr:last-child { border-bottom: none; }
        #weather-table td { padding: 16px 10px; text-align: center; color: var(--color-text-primary); font-size: 14px; font-weight: 500; }
        #weather-table .table-hour { font-weight: 700; color: #2C3E50; font-size: 15px; letter-spacing: 0.3px; }
        #weather-table .table-icon { font-size: 32px; }
        #weather-table .table-temp { font-weight: 600; font-size: 16px; color: #2C3E50; }
        #weather-table .table-rain { color: #2C3E50; font-weight: 600; }
        #weather-table .table-wind { color: #2C3E50; font-weight: 500; }
        .day-detailed-table { width: 100%; border-collapse: collapse; background: var(--color-bg-card); border-radius: 0; overflow: hidden; box-shadow: none; margin-bottom: 24px; backdrop-filter: blur(10px); }
        .day-detailed-table thead tr { background: #2C3E50; }
        .day-detailed-table thead th { padding: 16px 10px; text-align: center; color: #FFFFFF; font-weight: 700; font-size: 16px; text-transform: uppercase; letter-spacing: 1.2px; }
        .day-detailed-table tbody td { padding: 14px 10px; text-align: center; border-bottom: 1px solid rgba(148, 163, 184, 0.15); }
        .day-detailed-table tbody tr:last-child td { border-bottom: none; }
        .day-detailed-table .time-label { font-size: 13px; color: #2C3E50; font-weight: 600; letter-spacing: 0.3px; }
        .day-detailed-table .weather-icon-large { font-size: 40px; margin: 8px 0; }
        .day-detailed-table .rain-value { color: #3B82F6; font-weight: 700; font-size: 15px; }
        .day-detailed-table .info-label { font-size: 11px; color: var(--color-text-tertiary); text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 4px; font-weight: 600; }
        .day-detailed-table .info-value { font-size: 15px; font-weight: 700; color: var(--color-text-primary); }
        .day-detailed-table .temp-max { color: #EF4444; }
        .day-detailed-table .temp-min { color: #3B82F6; }
        .narrative-container { padding: 0; margin-top: 24px; }
        .narrative-title { font-size: 13px; font-weight: 700; color: var(--color-text-secondary); margin-bottom: 16px; text-transform: uppercase; letter-spacing: 1px; text-align: center; }
        #narrative-forecast { text-align: center; line-height: 1.7; font-size: 15px; color: var(--color-text-primary); font-weight: 400; letter-spacing: 0.2px; }
        #marine-forecast-table tbody tr { border-bottom: 1px solid rgba(148,163,184,0.15); }
        #marine-forecast-table tbody tr:nth-child(even) { background: rgba(241,245,249,0.6); }
        #marine-forecast-table tbody td { padding: 10px 8px; text-align: center; color: var(--color-text-primary); font-weight: 500; }
        .marine-forecast-container { margin: 40px 0; animation: fadeIn 0.6s ease-out 0.8s both; }
        .marine-forecast-title { font-size: 20px; font-weight: 700; color: var(--color-text-primary); margin-bottom: 20px; text-align: center; text-transform: uppercase; letter-spacing: 1.5px; }
        .marine-table { width: 100%; border-collapse: collapse; background: var(--color-bg-card); border-radius: 0; overflow: hidden; box-shadow: var(--shadow-md); backdrop-filter: blur(10px); margin-bottom: 24px; }
        .marine-table thead tr { background: #e6e6e6; }
        .marine-table thead th { padding: 16px 10px; text-align: center; color: #505050; font-weight: 700; font-size: 16px; text-transform: uppercase; letter-spacing: 1.2px; }
        .marine-table tbody td { padding: 16px 10px; text-align: center; border-bottom: 1px solid rgba(148, 163, 184, 0.15); font-size: 14px; color: var(--color-text-primary); font-weight: 500; }
        .marine-table tbody tr:nth-child(even) { background-color: rgba(241, 245, 249, 0.5); }
        .marine-table tbody tr:nth-child(odd) { background-color: rgba(255, 255, 255, 0.3); }
        .marine-table tbody tr:last-child td { border-bottom: none; }
        .marine-table .marine-label { font-weight: 700; color: var(--color-text-secondary); text-align: left; padding-left: 20px; font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px; }
        .marine-table .marine-value { font-weight: 700; font-size: 16px; }
        .marine-table .temp-water { color: #0EA5E9; }
        .marine-table .wave-height { color: #06B6D4; }
        .marine-table .uvi-value { font-weight: 700; }
        .astronomy-table { width: 100%; border-collapse: collapse; background: transparent; border-radius: 0; overflow: hidden; box-shadow: none; backdrop-filter: none; }
        .astronomy-table tbody td { padding: 10px 8px; border: none; font-size: 14px; text-align: center; }
        .astronomy-table tbody tr:first-child td { font-weight: 600; color: var(--color-text-secondary); font-size: 12px; text-transform: none; letter-spacing: 0.5px; padding-bottom: 8px; }
        .astronomy-table tbody tr:last-child td { font-weight: 700; color: var(--color-text-primary); font-size: 16px; padding-top: 4px; }
        .astronomy-table .astro-icon { margin-right: 6px; font-size: 14px; }
        .today-table { width: 100%; border-collapse: collapse; background: var(--color-bg-card); border-radius: 0; overflow: hidden; box-shadow: var(--shadow-md); backdrop-filter: blur(10px); }
        .today-table thead tr { background: #2C3E50; }
        .today-table thead th { padding: 16px 10px; text-align: center; color: #FFFFFF; font-weight: 700; font-size: 16px; text-transform: uppercase; letter-spacing: 1.2px; }
        .today-table tbody td { padding: 16px 10px; text-align: center; border-bottom: 1px solid rgba(148, 163, 184, 0.15); }
        .today-table tbody tr:last-child td { border-bottom: none; }
        .today-label { font-size: 9px; color: var(--color-text-tertiary); text-transform: uppercase; letter-spacing: 0.6px; margin-bottom: 4px; font-weight: 600; }
        .today-value { font-size: 13px; font-weight: 700; color: var(--color-text-primary); }
        /* â•â•â•â•â•â• TABLA FRANJAS DÃA â•â•â•â•â•â• */
        .franjas-wrap { background: #2c3e50; width: 100%; max-width: 600px; margin: 0 auto; }
        .franjas-cols { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; }
        .franja-col { padding: 14px 6px 16px; border-right: 1px solid rgba(255,255,255,0.15); text-align: center; }
        .franja-col:last-child { border-right: none; }
        .franja-nombre { font-size: 9px; font-weight: 700; color: #ffffff; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
        .franja-icon { font-size: 1.7rem; margin-bottom: 6px; line-height: 1; }
        .franja-icon i, .franja-icon i.wi { font-size: 1.7rem !important; color: #ffffff !important; }
        .franja-temp { font-size: 19px; font-weight: 800; color: #ffffff; margin-bottom: 8px; line-height: 1; }
        .franja-temp-label { font-size: 8px; color: #ffffff; text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 2px; }
        .franja-temp.es-min { color: #7ec8e3; }
        .franja-temp.es-max { color: #ff7c7c; }
        .franja-dato { font-size: 10px; color: #ffffff; margin-top: 4px; line-height: 1.7; }
        .franja-dato span { display: block; }
        /* â•â•â•â•â•â• FIN TABLA FRANJAS â•â•â•â•â•â• */

        /* â•â•â•â•â•â• CABECERA LLUVIA (fondo compartido) â•â•â•â•â•â• */
        .rain-header-bg {
            background: url('ff.jpg') center/cover no-repeat !important;
            position: relative;
            overflow: hidden;
        }
        /* Altura uniforme para los divs cabecera (no tr) */
        div.rain-header-bg {
            min-height: 52px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 10px;
        }
        .rain-header-bg > * { position: relative; z-index: 1; }
        /* â•â•â•â•â•â• FIN CABECERA LLUVIA â•â•â•â•â•â• */

        .webcam-container { display: flex; flex-direction: column; align-items: center; width: 100%; margin: 32px 0; animation: fadeIn 0.6s ease-out 1s both; }
        .webcam-frame { width: 100%; height: auto; aspect-ratio: 16 / 9; overflow: hidden; border: none; background: #000; border-radius: 0; box-shadow: var(--shadow-md); }
        .webcam-frame img { width: 100%; height: 100%; object-fit: cover; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           SECCIÃ“N PLAYAS â€” estilos
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .playas-section { margin: 0 auto; max-width: 600px; animation: fadeIn 0.6s ease-out 0.5s both; }
        .playas-header { background: #2c3e50; padding: 0 16px; display: flex; align-items: center; justify-content: center; gap: 8px; min-height: 52px; }
        .playas-header.rain-header-bg { background: url('ff.jpg') center/cover no-repeat !important; }
        .playas-header-title { font-size: 11px; font-weight: 700; color: #fff; text-transform: uppercase; letter-spacing: 1px; }
        .playas-card { display: flex; align-items: stretch; width: 100%; background: #fff; box-shadow: var(--shadow-md); }
        .playas-icon-col { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 24px 20px; background: #eaf4f8; min-width: 110px; gap: 10px; }
        .playas-sea-icon { width: 64px; height: 64px; }
        .playas-bandera-badge { display: flex; align-items: center; gap: 6px; padding: 5px 10px; border-radius: 4px; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
        .badge-verde  { background: #d1fae5; color: #065f46; }
        .badge-amarilla { background: #fef3c7; color: #92400e; }
        .badge-roja   { background: #fee2e2; color: #991b1b; }
        .bandera-dot  { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
        .dot-verde    { background: #10B981; }
        .dot-amarilla { background: #F59E0B; }
        .dot-roja     { background: #EF4444; }
        .playas-data-col { flex: 1; display: grid; grid-template-columns: 1fr 1fr; border-left: 1px solid #e2e8f0; }
        .playas-card-full { flex-direction: column; }
        .playas-data-full { display: grid; grid-template-columns: 1fr 1fr 1fr; width: 100%; }
        .playas-data-full .playas-dato { border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; }
        .playas-data-full .playas-dato:nth-child(3n) { border-right: none; }
        .playas-data-full .playas-dato:nth-last-child(-n+2) { border-bottom: none; }
        .playas-dato { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 18px 10px; border-bottom: 1px solid #e2e8f0; }
        .playas-dato:nth-child(odd) { border-right: 1px solid #e2e8f0; }
        .playas-dato:nth-last-child(-n+2) { border-bottom: none; }
        .playas-dato-label { font-size: 10px; font-weight: 700; color: var(--color-text-tertiary); text-transform: uppercase; letter-spacing: 0.7px; margin-bottom: 5px; }
        .playas-dato-value { font-size: 20px; font-weight: 700; color: #1a6b8a; }
        .playas-dato-value.uvi-value { color: #e07b00; }
        .playas-note { font-size: 11px; color: var(--color-text-tertiary); text-align: center; margin-top: 6px; padding: 0 24px 4px; font-style: italic; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           SECCIÃ“N ARTÃCULO â€” estilos
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .articulo-meteorologico {
            margin: 32px 0 0 0;
            padding-top: 28px;
            border-top: 1px solid #e2e8f0;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        .articulo-autor {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e2e8f0;
        }
        .articulo-autor-avatar {
            position: relative;
            width: 52px;
            height: 52px;
            flex-shrink: 0;
        }
        .articulo-autor-foto {
            width: 52px;
            height: 52px;
            border-radius: 50%;
            object-fit: cover;
            display: block;
            background: #e2e8f0;
        }
        .articulo-autor-initials {
            width: 52px;
            height: 52px;
            border-radius: 50%;
            background: #2C3E50;
            color: #ffffff;
            font-size: 16px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            letter-spacing: 1px;
        }
        .articulo-autor-info { display: flex; flex-direction: column; gap: 4px; }
        .articulo-autor-nombre { font-size: 13px; color: #64748B; font-weight: 400; letter-spacing: 0.3px; }
        .articulo-autor-nombre strong { color: #1E293B; font-weight: 700; }
        .articulo-autor-fecha { font-size: 12px; color: #94A3B8; font-weight: 500; text-transform: uppercase; letter-spacing: 0.4px; }
        .articulo-titulo { font-size: 24px; font-weight: 700; color: #1E293B; line-height: 1.3; margin: 0 0 22px 0; letter-spacing: -0.3px; }
        .articulo-imagen-wrapper { margin: 0 0 8px 0; border-radius: 8px; overflow: hidden; }
        .articulo-imagen-1 { width: 100%; height: 220px; object-fit: cover; display: block; background: #e2e8f0; }
        .articulo-imagen-pie { font-size: 12px; color: #94A3B8; margin: 0 0 20px 0; line-height: 1.4; }
        .articulo-imagen-pie strong { color: #64748B; }
        .articulo-cuerpo { font-size: 15px; color: #374151; line-height: 1.75; letter-spacing: 0.2px; }
        .articulo-cuerpo p { margin: 0 0 16px 0; }
        .articulo-cuerpo p:last-child { margin-bottom: 0; }
        .articulo-imagen-2 { width: 100%; height: 180px; object-fit: cover; display: block; border-radius: 8px; background: #e2e8f0; margin: 20px 0 8px 0; }
        .articulo-destacado { border-left: 4px solid #2C3E50; padding: 12px 18px; margin: 20px 0; background: #F8FAFC; border-radius: 0 8px 8px 0; font-size: 15px; font-weight: 600; color: #2C3E50; line-height: 1.5; font-style: italic; }
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           FIN estilos artÃ­culo
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        /* â•â•â•â•â•â•â•â•â•â• WIDGET PREVISIÃ“N 3 DÃAS â•â•â•â•â•â•â•â•â•â• */
        #prevision-widget {
          font-family: 'Inter', sans-serif;
          background: linear-gradient(160deg, #34495e 0%, #2c3e50 100%);
          padding: 0;
          overflow: hidden;
        }
        #prevision-widget .pw-title {
          display: flex; align-items: center; gap: 10px;
          padding: 14px 20px 10px;
        }
        #prevision-widget .pw-dot {
          width: 7px; height: 7px; border-radius: 50%;
          background: #4db6ac; flex-shrink: 0;
          animation: pw-pulse 2s infinite;
        }
        @keyframes pw-pulse {
          0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.5;transform:scale(1.5)}
        }
        #prevision-widget .pw-heading {
          color: rgba(255,255,255,0.7);
          font-size: 10px; font-weight: 700;
          letter-spacing: 2.5px; text-transform: uppercase;
        }
        #prevision-widget .pw-cards {
          display: flex; gap: 3px; padding: 0 3px 3px;
        }
        #prevision-widget .pw-card {
          flex: 1; background: rgba(255,255,255,0.06);
          border-radius: 4px; overflow: hidden;
          border: 1px solid rgba(255,255,255,0.1);
          display: flex; flex-direction: column;
          opacity: 0; transform: translateY(8px);
          transition: opacity .45s ease, transform .45s ease;
        }
        #prevision-widget .pw-card.pw-visible {
          opacity: 1; transform: translateY(0);
        }
        #prevision-widget .pw-card-head {
          padding: 8px 8px 6px; text-align: center;
          background: #263238; border-top: 3px solid;
        }
        #prevision-widget .pw-card:nth-child(1) .pw-card-head { border-color: #4caf50; }
        #prevision-widget .pw-card:nth-child(2) .pw-card-head { border-color: #cddc39; }
        #prevision-widget .pw-card:nth-child(3) .pw-card-head { border-color: #ffc107; }
        #prevision-widget .pw-day-name {
          color: #fff; font-size: 12px; font-weight: 700;
          text-transform: capitalize; letter-spacing: .3px;
        }
        #prevision-widget .pw-day-date {
          color: rgba(255,255,255,.38); font-size: 9px;
          letter-spacing: 1px; margin-top: 1px;
        }
        /* Temps */
        #prevision-widget .pw-temps {
          background: #1a252b;
          display: flex; justify-content: center;
          align-items: center; gap: 10px; padding: 7px 6px;
        }
        #prevision-widget .pw-tmax {
          font-size: 18px; font-weight: 800; color: #ff8a65; line-height: 1;
        }
        #prevision-widget .pw-tmin {
          font-size: 13px; font-weight: 700; color: #80cbc4; line-height: 1;
        }
        #prevision-widget .pw-tdiv {
          width: 1px; height: 20px; background: rgba(255,255,255,.12);
        }
        #prevision-widget .pw-ttag {
          font-size: 8px; letter-spacing: .8px; text-transform: uppercase;
          font-weight: 700; display: block; text-align: center;
        }
        #prevision-widget .pw-ttag-max { color: rgba(255,138,101,.55); }
        #prevision-widget .pw-ttag-min { color: rgba(128,203,196,.55); }
        /* Map */
        #prevision-widget .pw-map {
          position: relative; height: 190px;
          background: linear-gradient(155deg, #9fb8c4 0%, #b8cdd5 100%);
          overflow: hidden; flex: 1;
        }
        #prevision-widget .pw-sea {
          position: absolute; bottom: 0; left: 0; right: 0;
          height: 55px;
          background: linear-gradient(180deg,#4db6ac 0%,#26a69a 100%);
          clip-path: polygon(0 38%,100% 8%,100% 100%,0 100%);
        }
        #prevision-widget .pw-sea-lbl {
          position: absolute; bottom: 7px; left: 50%;
          transform: translateX(-50%);
          color: rgba(255,255,255,.3); font-size: 6px;
          letter-spacing: 2.5px; text-transform: uppercase;
          white-space: nowrap; z-index: 4;
        }
        #prevision-widget .pw-wind-lbl {
          position: absolute; top: 5px; right: 6px;
          font-size: 7px; color: rgba(255,255,255,.42);
          letter-spacing: 1.5px; text-transform: uppercase; z-index: 6;
        }
        #prevision-widget .pw-wicon {
          position: absolute; font-size: 1.4rem; z-index: 5;
          filter: drop-shadow(0 2px 5px rgba(0,0,0,.4));
        }
        #prevision-widget .pw-pin {
          position: absolute; z-index: 6;
          display: flex; flex-direction: column; align-items: center; gap: 2px;
        }
        #prevision-widget .pw-pin-dot {
          width: 5px; height: 5px; background: #fff;
          border-radius: 50%; border: 1.5px solid rgba(0,0,0,.35);
          box-shadow: 0 1px 3px rgba(0,0,0,.4);
        }
        #prevision-widget .pw-pin-name {
          background: rgba(15,25,30,.75); color: #fff;
          font-size: 6.5px; font-weight: 700; padding: 1px 4px;
          border-radius: 2px; letter-spacing: .4px; white-space: nowrap;
        }
        /* Summary bar */
        #prevision-widget .pw-summary {
          background: #1a252b;
          display: flex; align-items: center; gap: 10px; padding: 8px 10px;
        }
        #prevision-widget .pw-big-icon {
          font-size: 2rem; line-height: 1; flex-shrink: 0;
          filter: drop-shadow(0 2px 6px rgba(0,0,0,.45));
        }
        #prevision-widget .pw-summary-right { display: flex; flex-direction: column; gap: 3px; flex: 1; }
        #prevision-widget .pw-cond-text {
          color: #eceff1; font-size: 10px; font-weight: 700; letter-spacing: .2px;
        }
        #prevision-widget .pw-precip-row {
          display: flex; align-items: center; gap: 4px;
        }
        #prevision-widget .pw-precip-val {
          font-size: 10px; font-weight: 700; color: #80cbc4;
        }
        #prevision-widget .pw-precip-lbl {
          font-size: 8.5px; color: #546e7a; letter-spacing: .3px;
        }
        #prevision-widget .pw-precip-bar-wrap {
          height: 3px; background: rgba(255,255,255,.08);
          border-radius: 2px; overflow: hidden; margin-top: 2px;
        }
        #prevision-widget .pw-precip-bar-fill {
          height: 100%; border-radius: 2px;
          background: linear-gradient(90deg,#4db6ac,#80cbc4);
          transition: width 1s ease;
        }
        /* Bottom wind/sea */
        #prevision-widget .pw-bottom {
          background: #151f24;
          display: flex; justify-content: center;
          align-items: center; gap: 16px; padding: 8px 8px;
          flex-wrap: wrap;
        }
        #prevision-widget .pw-info {
          display: flex; flex-direction: column; align-items: center; gap: 2px;
        }
        #prevision-widget .pw-info svg { width: 24px; height: 24px; }
        #prevision-widget .pw-info-val {
          font-size: 9px; font-weight: 700; color: #b0bec5;
        }
        #prevision-widget .pw-info-lbl {
          font-size: 7.5px; color: #546e7a; text-align: center;
        }

        @media (max-width: 480px) {
          #prevision-widget .pw-map { height: 155px; }
          #prevision-widget .pw-tmax { font-size: 15px; }
          #prevision-widget .pw-tmin { font-size: 11px; }
        }
        /* â•â•â•â•â•â•â•â•â•â• FIN WIDGET â•â•â•â•â•â•â•â•â•â• */

        @media (max-width: 480px) {
            .header-section { padding: 0; min-height: 150px; }
            .content-section { padding: 16px; }
            body { overflow-x: hidden; max-width: 100vw; }
            .temperature { font-size: 64px; }
            .icon-large { font-size: 64px; }
            .radar-frame { height: 300px; }
            #weather-table th, #weather-table td { padding: 12px 6px; font-size: 12px; }
            #weather-table .table-icon { font-size: 26px; }
            .alert-banner-item { flex-direction: column; align-items: flex-start; gap: 10px; }
            .alert-banner-left { width: 100%; }
            .alert-banner-level { align-self: flex-start; }
            .details { gap: 16px; }
            .detail-item { min-width: 80px; }
            .articulo-titulo { font-size: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">

        <div class="header-section"></div>

        <div class="content-section">

            <div class="current-weather">
                <div style="font-size: 13px; font-weight: 700; color: var(--color-text-secondary); margin-bottom: 16px; text-transform: uppercase; letter-spacing: 1px;">Tiempo Actual</div>
                <div class="icon-large" id="current-icon">â˜€ï¸</div>
                <div class="temperature" id="current-temp">--Â°</div>
                <div class="details">
                    <div class="detail-item">
                        <div>PresiÃ³n</div>
                        <div class="detail-value" id="pressure">-- hPa</div>
                    </div>
                    <div class="detail-item">
                        <div>Humedad</div>
                        <div class="detail-value" id="humidity">--%</div>
                    </div>
                    <div class="detail-item">
                        <div>Viento</div>
                        <div class="detail-value" id="wind">-- km/h</div>
                    </div>
                    <div class="detail-item">
                        <div>Precip. hoy</div>
                        <div class="detail-value" id="precip-today">-- mm</div>
                    </div>
                    <div class="detail-item">
                        <div>Calidad Aire</div>
                        <div class="detail-value" id="air-quality-current" style="color: #2C3E50;">--</div>
                    </div>
                    <div class="detail-item">
                        <div>UVI actual</div>
                        <div class="detail-value" id="uvi-current">--</div>
                    </div>
                </div>

                <!-- BLOQUE DE AVISOS -->
                <div class="aviso-box" style="width: 100%; background: #F8F8FF; border-radius: 12px; margin: 28px 0 0 0; padding: 20px 24px;">
                    <div style="color: #2C3E50; font-size: 14px; font-weight: 700; margin-bottom: 6px; letter-spacing: 0.3px;">SIN AVISOS ACTIVOS</div>
                    <div style="color: #2C3E50; font-size: 12px; font-weight: 500; line-height: 1.5;">No hay fenÃ³menos adversos previstos</div>
                </div>


            </div><!-- fin current-weather -->

        </div><!-- fin content-section -->




        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             SECCIÃ“N PLAYAS DE BARCELONA
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div class="playas-section">
            <div class="playas-header rain-header-bg">
                <span class="playas-header-title">Playas â€” Estado de la mar</span>
            </div>

            <!-- PrevisiÃ³n marina por franjas -->
            <div id="marine-summary-blocks" style="background:#f0f8ff; max-width: 600px; margin: 0 auto;">
                <div style="padding:16px;text-align:center;color:#94a3b8;font-size:13px;">Cargando previsiÃ³n marinaâ€¦</div>
            </div>
        </div>

        <!-- TABLA PRECIPITACIONES 7 DÃAS -->
        <div id="rain-7days-container" style="max-width:600px;margin:40px auto 0;"></div>

        <div class="weather-table-container" style="margin-top: 28px;">
            <div id="days-detailed-container">
                <div style="padding: 20px; text-align: center; color: var(--color-text-tertiary);">Cargando datos...</div>
            </div>
            <div id="days-summary-container" style="margin-top: 28px;">
                <div style="padding: 20px; text-align: center; color: var(--color-text-tertiary);">Cargando datos...</div>
            </div>
        </div>

        <div class="webcam-container">
            <span class="webcam-label">WEBCAM / VILA OLÃMPICA</span>
            <div class="webcam-frame">
                <img id="webcam-jpg" src="https://imgproxy.windy.com/_/full/plain/current/1647901683/original.jpg" alt="vila olimpica"/>
            </div>
        </div>

        <div class="webcam-container">
            <span class="webcam-label">WEBCAM / SAGRADA FAMÃLIA</span>
            <div class="webcam-frame">
                <img src="https://imgproxy.windy.com/_/normal/plain/current/1448811166/original.jpg" alt="sagrada familia"/>
            </div>
        </div>



        <div class="update-time" id="update-time">Actualizado: --:--</div>

        <div class="divulgacion-link">
            <a href="divulgacion.html">Aprende meteorologÃ­a</a>
        </div>

    </div><!-- fin container -->

    <script>
        const LAT = 41.3851;
        const LON = 2.1734;

        // Fecha automÃ¡tica del artÃ­culo
        (function() {
            const meses = ['ENE','FEB','MAR','ABR','MAY','JUN','JUL','AGO','SEP','OCT','NOV','DIC'];
            const ahora = new Date();
            const dia = String(ahora.getDate()).padStart(2,'0');
            const mes = meses[ahora.getMonth()];
            const anyo = String(ahora.getFullYear()).slice(2);
            const hh = String(ahora.getHours()).padStart(2,'0');
            const mm = String(ahora.getMinutes()).padStart(2,'0');
            const el = document.getElementById('articulo-fecha');
            if (el) el.textContent = `ACTUALIZADO ${dia} ${mes} ${anyo}`;
        })();

        const weatherIcons = {
            0:'<i class="wi wi-day-sunny"></i>',1:'<i class="wi wi-day-sunny-overcast"></i>',
            2:'<i class="wi wi-day-cloudy"></i>',3:'<i class="wi wi-cloudy"></i>',
            45:'<i class="wi wi-fog"></i>',48:'<i class="wi wi-fog"></i>',
            51:'<i class="wi wi-sprinkle"></i>',53:'<i class="wi wi-sprinkle"></i>',
            55:'<i class="wi wi-rain"></i>',61:'<i class="wi wi-rain"></i>',
            63:'<i class="wi wi-rain"></i>',65:'<i class="wi wi-rain-wind"></i>',
            71:'<i class="wi wi-snow"></i>',73:'<i class="wi wi-snow"></i>',
            75:'<i class="wi wi-snow-wind"></i>',80:'<i class="wi wi-showers"></i>',
            81:'<i class="wi wi-showers"></i>',82:'<i class="wi wi-storm-showers"></i>',
            95:'<i class="wi wi-thunderstorm"></i>',96:'<i class="wi wi-thunderstorm"></i>',
            99:'<i class="wi wi-thunderstorm"></i>'
        };
        const weatherIconsNight = {
            0:'<i class="wi wi-night-clear"></i>',1:'<i class="wi wi-night-alt-cloudy"></i>',
            2:'<i class="wi wi-night-alt-cloudy"></i>',3:'<i class="wi wi-cloudy"></i>',
            45:'<i class="wi wi-night-fog"></i>',48:'<i class="wi wi-night-fog"></i>',
            51:'<i class="wi wi-night-alt-sprinkle"></i>',53:'<i class="wi wi-night-alt-sprinkle"></i>',
            55:'<i class="wi wi-night-alt-rain"></i>',61:'<i class="wi wi-night-alt-rain"></i>',
            63:'<i class="wi wi-night-alt-rain"></i>',65:'<i class="wi wi-night-alt-rain-wind"></i>',
            71:'<i class="wi wi-night-alt-snow"></i>',73:'<i class="wi wi-night-alt-snow"></i>',
            75:'<i class="wi wi-night-alt-snow-wind"></i>',80:'<i class="wi wi-night-alt-showers"></i>',
            81:'<i class="wi wi-night-alt-showers"></i>',82:'<i class="wi wi-night-alt-storm-showers"></i>',
            95:'<i class="wi wi-night-alt-thunderstorm"></i>',96:'<i class="wi wi-night-alt-thunderstorm"></i>',
            99:'<i class="wi wi-night-alt-thunderstorm"></i>'
        };
        const weatherDescriptions = {
            0:'Despejado',1:'Principalmente despejado',2:'Parcialmente nublado',3:'Nublado',
            45:'Niebla',48:'Niebla con escarcha',51:'Llovizna ligera',53:'Llovizna moderada',
            55:'Llovizna densa',61:'Lluvia ligera',63:'Lluvia moderada',65:'Lluvia intensa',
            71:'Nevada ligera',73:'Nevada moderada',75:'Nevada intensa',
            80:'Chubascos ligeros',81:'Chubascos moderados',82:'Chubascos violentos',
            95:'Tormenta',96:'Tormenta con granizo',99:'Tormenta fuerte'
        };

        let sunriseTime = null, sunsetTime = null;

        function isNightTime(dt) {
            if (!sunriseTime || !sunsetTime) return false;
            const t = new Date(dt), sr = new Date(sunriseTime), ss = new Date(sunsetTime);
            sr.setFullYear(t.getFullYear(),t.getMonth(),t.getDate());
            ss.setFullYear(t.getFullYear(),t.getMonth(),t.getDate());
            return t < sr || t > ss;
        }

        function getWeatherIcon(code, dateTime, cloudData) {
            if (cloudData && (code===1||code===2||code===3)) {
                const rc = (cloudData.cloud_cover_low||0)+((cloudData.cloud_cover_mid||0)*0.5);
                if (rc<15) code=1; else if (rc<35) code=2; else code=3;
            }
            if (dateTime && isNightTime(dateTime)) return weatherIconsNight[code]||'<i class="wi wi-night-clear"></i>';
            return weatherIcons[code]||'<i class="wi wi-day-sunny"></i>';
        }

        function getDayName(ds) {
            return ['Domingo','Lunes','Martes','MiÃ©rcoles','Jueves','Viernes','SÃ¡bado'][new Date(ds).getDay()];
        }

        function updateFranjasTable(hourly, daily) {
            const wrap = document.getElementById('franjas-tabla');
            if (!wrap || !hourly?.time || !hourly.time.length) return;

            const now = new Date();
            const DIAS = ['Domingo','Lunes','Martes','MiÃ©rcoles','Jueves','Viernes','SÃ¡bado'];

            // Fecha local YYYY-MM-DD
            function fechaLocal(d) {
                return d.getFullYear() + '-' +
                    String(d.getMonth()+1).padStart(2,'0') + '-' +
                    String(d.getDate()).padStart(2,'0');
            }

            // Buscar Ã­ndice en hourly por fecha local + hora
            function idxHora(fecha, h) {
                const key = fecha + 'T' + String(h).padStart(2,'0');
                return hourly.time.findIndex(t => t.startsWith(key));
            }

            // DefiniciÃ³n de franjas
            const DEFS = [
                { tipo:'madrugada', label:'Madrugada', h0:0,  h1:7  },
                { tipo:'manana',    label:'MaÃ±ana',    h0:7,  h1:13 },
                { tipo:'tarde',     label:'Tarde',     h0:13, h1:21 },
                { tipo:'noche',     label:'Noche',     h0:21, h1:24 },
            ];

            // Generar franjas de hoy y maÃ±ana
            const candidatas = [];
            for (let dOff = 0; dOff <= 1; dOff++) {
                const dia = new Date(now.getFullYear(), now.getMonth(), now.getDate() + dOff);
                const fecha = fechaLocal(dia);
                const diaNombre = DIAS[dia.getDay()];
                for (const def of DEFS) {
                    // La franja termina a h1 horas del dÃ­a
                    const finMs = dia.getTime() + def.h1 * 3600000;
                    if (finMs <= now.getTime()) continue; // ya pasÃ³
                    candidatas.push({ ...def, fecha, diaNombre });
                }
            }

            const franjas = candidatas.slice(0, 4);
            if (!franjas.length) { wrap.innerHTML = ''; return; }

            function getWindDir(deg) {
                return ['N','NE','E','SE','S','SO','O','NO'][Math.round((deg||0)/45)%8];
            }

            function buildCol(f) {
                // Ãndices de horas de esta franja
                const ids = [];
                for (let h = f.h0; h < f.h1; h++) {
                    const i = idxHora(f.fecha, h);
                    if (i !== -1) ids.push(i);
                }
                if (!ids.length) return null;

                // Icono: hora central
                const mi = ids[Math.floor(ids.length / 2)];
                const esNoche = (f.tipo === 'noche' || f.tipo === 'madrugada');
                const iconDt = new Date(f.fecha + 'T' + (esNoche ? '23' : String(Math.floor((f.h0+f.h1)/2)).padStart(2,'0')) + ':00:00');
                const cd = { cloud_cover: hourly.cloud_cover?.[mi], cloud_cover_low: hourly.cloud_cover_low?.[mi], cloud_cover_mid: hourly.cloud_cover_mid?.[mi] };
                const icon = getWeatherIcon(hourly.weather_code?.[mi] ?? 0, iconDt, cd);

                // Lluvia total
                const precip = ids.reduce((s,i) => s + (hourly.precipitation?.[i]||0), 0).toFixed(1);

                // Viento medio
                const vv = ids.map(i => hourly.wind_speed_10m?.[i]||0);
                const vd = ids.map(i => hourly.wind_direction_10m?.[i]||0);
                const spd = Math.round(vv.reduce((a,b)=>a+b,0)/vv.length);
                const dir = getWindDir(vd.reduce((a,b)=>a+b,0)/vd.length);

                // Temperatura
                const dayIdx = daily?.time ? daily.time.findIndex(t => t === f.fecha) : -1;
                let temp = '--', tempLabel = '', tempClass = '', extra = '';

                if (f.tipo === 'manana') {
                    temp = dayIdx !== -1 ? Math.round(daily.temperature_2m_min[dayIdx]) : Math.round(Math.min(...ids.map(i=>hourly.temperature_2m?.[i]??99)));
                    tempLabel = 'mÃ­nima'; tempClass = 'es-min';
                    if (dayIdx !== -1 && daily.sunrise?.[dayIdx]) {
                        const sr = new Date(daily.sunrise[dayIdx]);
                        extra = '<span>ğŸŒ… ' + String(sr.getHours()).padStart(2,'0') + ':' + String(sr.getMinutes()).padStart(2,'0') + '</span>';
                    }
                } else if (f.tipo === 'tarde') {
                    temp = dayIdx !== -1 ? Math.round(daily.temperature_2m_max[dayIdx]) : Math.round(Math.max(...ids.map(i=>hourly.temperature_2m?.[i]??-99)));
                    tempLabel = 'mÃ¡xima'; tempClass = 'es-max';
                    if (dayIdx !== -1 && daily.sunset?.[dayIdx]) {
                        const ss = new Date(daily.sunset[dayIdx]);
                        extra = '<span>ğŸŒ‡ ' + String(ss.getHours()).padStart(2,'0') + ':' + String(ss.getMinutes()).padStart(2,'0') + '</span>';
                    }
                } else if (f.tipo === 'noche') {
                    const i23 = idxHora(f.fecha, 23);
                    temp = i23 !== -1 ? Math.round(hourly.temperature_2m[i23]) : Math.round(hourly.temperature_2m[ids[ids.length-1]]);
                    tempLabel = '23:00h';
                } else {
                    const i04 = idxHora(f.fecha, 4);
                    temp = i04 !== -1 ? Math.round(hourly.temperature_2m[i04]) : Math.round(hourly.temperature_2m[ids[0]]);
                    tempLabel = '04:00h';
                }

                return { icon, precip, spd, dir, temp, tempLabel, tempClass, extra };
            }

            let html = '<div class="franjas-wrap"><div class="franjas-cols">';
            franjas.forEach(f => {
                const d = buildCol(f);
                if (!d) return;
                html += '<div class="franja-col">' +
                    '<div class="franja-nombre">' + f.diaNombre + ' ' + f.label + '</div>' +
                    '<div class="franja-icon">' + d.icon + '</div>' +
                    '<div class="franja-temp-label">' + d.tempLabel + '</div>' +
                    '<div class="franja-temp ' + d.tempClass + '">' + d.temp + 'Â°</div>' +
                    '<div class="franja-dato">' +
                        '<span>ğŸ’§ ' + d.precip + ' mm</span>' +
                        '<span>ğŸ’¨ ' + d.spd + ' km/h ' + d.dir + '</span>' +
                        d.extra +
                    '</div>' +
                '</div>';
            });
            html += '</div></div>';
            wrap.innerHTML = html;
        }
        function updateTodayTable(daily, hourly) {
            // Tabla eliminada â€” funciÃ³n vacÃ­a para evitar errores JS
        }

        function formatHour(s) { return new Date(s).getHours().toString().padStart(2,'0')+':00'; }

        function updateAirQualityTable(ac) {
            function lvl(aqi) {
                if(aqi<=20)return'Buena';if(aqi<=40)return'Aceptable';if(aqi<=60)return'Moderada';
                if(aqi<=80)return'Desfavorable';if(aqi<=100)return'Muy desfavorable';return'Extremadamente desfavorable';
            }
            const el=document.getElementById('air-quality-current');
            el.textContent=lvl(ac.european_aqi||0); el.style.color='#2C3E50';
        }

        function updatePlayasTable(marine, daily, marineHourly, weatherHourly) {
            function getWindDir(deg) { return ['N','NE','E','SE','S','SO','O','NO'][Math.round(deg/45)%8]; }

            function getEstadoMar(h) {
                if (h === null) return 'â€”';
                if (h < 0.1)  return 'Calma';
                if (h < 0.5)  return 'Rizada';
                if (h < 1.25) return 'Marejadilla';
                if (h < 2.5)  return 'Marejada';
                if (h < 4.0)  return 'Fuerte marejada';
                return 'Mar gruesa';
            }

            function getWaveColor(h) {
                if (h === null || h < 0.5) return '#0ea5e9';
                if (h < 1.25) return '#f59e0b';
                if (h < 2.5)  return '#f97316';
                return '#ef4444';
            }

            // â”€â”€ PrevisiÃ³n por franjas dÃ­a/maÃ±ana/tarde â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            const container = document.getElementById('marine-summary-blocks');
            if (!container || !marineHourly?.time) return;
            container.innerHTML = '';

            const now  = new Date();
            const dias = ['domingo','lunes','martes','miÃ©rcoles','jueves','viernes','sÃ¡bado'];

            // Lookup viento atmosfÃ©rico por clave "YYYY-MM-DDTHH"
            const windLookup = {};
            if (weatherHourly?.time) {
                weatherHourly.time.forEach((t, i) => {
                    windLookup[t.slice(0,13)] = {
                        ws:  weatherHourly.wind_speed_10m?.[i]     ?? null,
                        wsd: weatherHourly.wind_direction_10m?.[i] ?? null,
                    };
                });
            }

            function getBeaufort(kmh) {
                if (kmh === null) return '';
                if (kmh < 1)  return 'Calma';
                if (kmh < 6)  return 'Ventolina';
                if (kmh < 12) return 'Brisa muy dÃ©bil';
                if (kmh < 20) return 'Brisa dÃ©bil';
                if (kmh < 29) return 'Brisa moderada';
                if (kmh < 39) return 'Brisa fresca';
                if (kmh < 50) return 'Brisa fuerte';
                if (kmh < 62) return 'Viento fuerte';
                if (kmh < 75) return 'Temporal';
                return 'Temporal fuerte';
            }

            // Recoge slots marinos de un dÃ­a y franja horaria concretos
            function getSlots(targetDate, fromH, toH) {
                const res = [];
                for (let i = 0; i < marineHourly.time.length; i++) {
                    const ht = new Date(marineHourly.time[i]);
                    if (ht.getFullYear() !== targetDate.getFullYear() ||
                        ht.getMonth()    !== targetDate.getMonth()    ||
                        ht.getDate()     !== targetDate.getDate())     continue;
                    if (ht.getHours() < fromH || ht.getHours() >= toH) continue;
                    const key = marineHourly.time[i].slice(0,13);
                    const w   = windLookup[key] ?? { ws: null, wsd: null };
                    res.push({
                        wh:  marineHourly.wave_height?.[i]             ?? null,
                        wp:  marineHourly.wave_period?.[i]             ?? null,
                        wd:  marineHourly.wave_direction?.[i]          ?? null,
                        sst: marineHourly.sea_surface_temperature?.[i] ?? null,
                        ws:  w.ws,
                        wsd: w.wsd,
                    });
                }
                return res;
            }

            function avg(arr) { return arr.length ? arr.reduce((a,b)=>a+b,0)/arr.length : null; }

            function getCalidadBanyo(avgWH, avgWS, avgSST, uvi) {
                // PuntuaciÃ³n: empezamos en 5 y vamos restando
                let score = 5;
                // Oleaje
                if (avgWH !== null) {
                    if (avgWH >= 2.5) score -= 3;
                    else if (avgWH >= 1.25) score -= 2;
                    else if (avgWH >= 0.5)  score -= 1;
                }
                // Viento
                if (avgWS !== null) {
                    if (avgWS >= 50) score -= 2;
                    else if (avgWS >= 29) score -= 1;
                }
                // Temperatura agua
                if (avgSST !== null) {
                    if (avgSST < 16) score -= 2;
                    else if (avgSST < 20) score -= 1;
                    else if (avgSST >= 28) score -= 1; // demasiado caliente, medusas
                }
                // UVI extremo (quemadura rÃ¡pida)
                if (uvi !== null && uvi >= 10) score -= 1;

                score = Math.max(1, Math.min(5, score));

                const niveles = {
                    5: { texto: 'Excelente',      color: '#10b981' },
                    4: { texto: 'Buena',           color: '#10b981' },
                    3: { texto: 'Aceptable',       color: '#f59e0b' },
                    2: { texto: 'Mejorable',       color: '#f97316' },
                    1: { texto: 'No aconsejable',  color: '#ef4444' },
                };
                return { score, ...niveles[score] };
            }

            function renderStrip(dayLabel, subLabel, slots, isActive, uviVal) {
                if (!slots.length) return;
                const whs  = slots.map(s=>s.wh).filter(v=>v!==null);
                const wps  = slots.map(s=>s.wp).filter(v=>v!==null);
                const wss  = slots.map(s=>s.ws).filter(v=>v!==null);
                const wsds = slots.map(s=>s.wsd).filter(v=>v!==null);
                const ssts = slots.map(s=>s.sst).filter(v=>v!==null);

                const minWH  = whs.length ? Math.min(...whs) : null;
                const maxWH  = whs.length ? Math.max(...whs) : null;
                const avgWH  = whs.length ? avg(whs) : null;
                const avgWP  = wps.length ? Math.round(avg(wps)) : null;
                const avgWS  = wss.length  ? Math.round(avg(wss))  : null;
                const maxWS  = wss.length  ? Math.round(Math.max(...wss)) : null;
                const avgWSD = wsds.length ? Math.round(avg(wsds)) : null;
                const avgSST = ssts.length ? Math.round(avg(ssts)) : null;   // redondeado

                const estado   = getEstadoMar(avgWH);
                const color    = getWaveColor(avgWH);
                const beaufort = getBeaufort(avgWS);
                const bgLabel  = isActive ? '#0f4f6b' : '#1a6b8a';
                const calidad  = getCalidadBanyo(avgWH, avgWS, avgSST, uviVal);
                const textCol  = '#1a6b8a';   // color cabecera para todos los textos

                let oleajeTxt = 'â€”';
                if (minWH !== null && maxWH !== null) {
                    oleajeTxt = Math.abs(maxWH - minWH) < 0.08
                        ? minWH.toFixed(2) + ' m'
                        : minWH.toFixed(2) + 'â€“' + maxWH.toFixed(2) + ' m';
                }

                const dirTxt    = avgWSD !== null ? getWindDir(avgWSD) : '';
                const maxExtra  = maxWS && avgWS && maxWS > avgWS + 5 ? ` (mÃ¡x ${maxWS})` : '';
                const vientoTxt = avgWS  !== null ? `${avgWS} km/h ${dirTxt}${maxExtra} Â· ${beaufort}` : 'â€”';
                const aguaTxt   = avgSST !== null ? avgSST + ' Â°C' : 'â€”';
                const uviTxt    = uviVal  !== null ? Math.round(uviVal) : 'â€”';   // redondeado

                // Degradado sutil segÃºn intensidad del mar
                const seaGrads = {
                    'Calma':           'linear-gradient(135deg, #e8f4fd 0%, #f0f8ff 60%, #ffffff 100%)',
                    'Rizada':          'linear-gradient(135deg, #daeef9 0%, #edf6fc 60%, #f8fcff 100%)',
                    'Marejadilla':     'linear-gradient(135deg, #cce5f5 0%, #e4f2fb 60%, #f5fafe 100%)',
                    'Marejada':        'linear-gradient(135deg, #b8d8ef 0%, #d5ecf8 60%, #eef7fd 100%)',
                    'Fuerte marejada': 'linear-gradient(135deg, #a0c8e6 0%, #c4e0f5 60%, #e5f3fb 100%)',
                    'Mar gruesa':      'linear-gradient(135deg, #88b8da 0%, #b0d2ec 60%, #d8edf8 100%)',
                };
                const bgGrad = seaGrads[estado] || seaGrads['Marejadilla'];

                // Ola SVG decorativa sutil en azul claro
                function makeWaveSVG(amp) {
                    const w = 400, h = 40;
                    const y = h * 0.6;
                    const d1 = `M0,${y} C80,${y-amp} 160,${y+amp} 240,${y} C320,${y-amp} 380,${y+amp*0.5} 400,${y} L400,${h} L0,${h} Z`;
                    const d2 = `M0,${y+4} C60,${y+4-amp*0.7} 140,${y+4+amp*0.7} 220,${y+4} C300,${y+4-amp*0.7} 370,${y+4+amp*0.4} 400,${y+4} L400,${h} L0,${h} Z`;
                    const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="${w}" height="${h}" viewBox="0 0 ${w} ${h}">
                        <path d="${d1}" fill="rgba(44,120,180,0.10)"/>
                        <path d="${d2}" fill="rgba(44,120,180,0.06)"/>
                    </svg>`;
                    return `data:image/svg+xml;charset=utf-8,${encodeURIComponent(svg)}`;
                }

                const waveAmps = {'Calma':4,'Rizada':7,'Marejadilla':11,'Marejada':16,'Fuerte marejada':21,'Mar gruesa':26};
                const waveSvg = makeWaveSVG(waveAmps[estado] || 8);

                const div = document.createElement('div');
                div.style.cssText = `
                    display:flex;
                    align-items:stretch;
                    border-bottom:1px solid #dbeaf5;
                    overflow:hidden;
                    background:${bgGrad};
                    position:relative;
                `;
                div.innerHTML = `
                    <!-- ola decorativa en el fondo -->
                    <div style="position:absolute;bottom:0;left:0;right:0;height:40px;
                                background-image:url('${waveSvg}');
                                background-size:cover;background-repeat:no-repeat;
                                pointer-events:none;"></div>

                    <!-- columna izquierda: dÃ­a + franja -->
                    <div style="
                        background:rgba(44,100,150,0.12);
                        padding:14px 10px;
                        display:flex;flex-direction:column;
                        align-items:center;justify-content:center;
                        min-width:80px;flex-shrink:0;gap:4px;
                        border-right:1px solid rgba(44,100,150,0.15);
                    ">
                        <span style="color:#2c3e50;font-size:12px;font-weight:800;text-transform:uppercase;letter-spacing:0.5px;text-align:center;">${dayLabel}</span>
                        <span style="color:#2c3e50;font-size:10px;font-weight:600;text-transform:capitalize;opacity:0.65;">${subLabel}</span>
                        <span style="margin-top:6px;font-size:22px;">ğŸŒŠ</span>
                    </div>

                    <!-- columna derecha: datos -->
                    <div style="position:relative;z-index:1;flex:1;padding:13px 15px;display:flex;flex-direction:column;gap:8px;justify-content:center;">

                        <!-- oleaje: altura pequeÃ±a + estado Â· perÃ­odo en misma lÃ­nea -->
                        <div style="display:flex;align-items:baseline;gap:6px;flex-wrap:wrap;margin-bottom:-2px;">
                            <span style="font-size:13px;font-weight:800;color:#2c3e50;">${oleajeTxt}</span>
                            <span style="font-size:11px;color:#2c3e50;opacity:0.45;font-weight:500;">altura olas</span>
                        </div>
                        <div style="display:flex;align-items:center;gap:7px;flex-wrap:wrap;">
                            <span style="font-size:11px;font-weight:700;color:#fff;background:${color};padding:2px 8px;border-radius:4px;box-shadow:0 1px 4px rgba(0,0,0,0.12);">${estado}</span>
                            ${avgWP !== null ? `<span style="font-size:12px;color:#1a6b8a;font-weight:600;">Â· ${avgWP}s perÃ­odo</span>` : ''}
                        </div>

                        <!-- viento + agua + uvi -->
                        <div style="font-size:12px;color:#2c3e50;line-height:1.75;">
                            <span style="font-weight:600;">${vientoTxt}</span><br>
                            Agua <span style="font-weight:700;color:#1a6b8a;">${aguaTxt}</span>
                            &nbsp;Â·&nbsp; UVI <span style="font-weight:700;color:#2c3e50;">${uviTxt}</span>
                        </div>

                        <!-- calidad baÃ±o -->
                        <div style="display:flex;align-items:center;gap:6px;">
                            <span style="font-size:11px;color:#2c3e50;opacity:0.6;">Calidad del baÃ±o:</span>
                            <span style="
                                font-size:12px;font-weight:800;
                                color:#fff;background:${calidad.color};
                                padding:2px 10px;border-radius:4px;
                                box-shadow:0 1px 4px rgba(0,0,0,0.12);
                            ">${calidad.texto}</span>
                            <span style="font-size:9px;color:#2c3e50;opacity:0.35;">*</span>
                        </div>

                    </div>`;
                container.appendChild(div);
            }

            const hoy        = new Date(now);
            const manana     = new Date(now); manana.setDate(manana.getDate() + 1);
            const pasadoman  = new Date(now); pasadoman.setDate(pasadoman.getDate() + 2);
            const uviHoy       = daily?.uv_index_max?.[0] ?? null;
            const uviManana    = daily?.uv_index_max?.[1] ?? null;
            const uviPasadoman = daily?.uv_index_max?.[2] ?? null;

            // Pool de todas las franjas posibles (hoy + maÃ±ana + pasado maÃ±ana)
            const todasFranjas = [
                { date: hoy,       from: 6,  to: 13, label: 'maÃ±ana', sub: dias[hoy.getDay()],       uvi: uviHoy       },
                { date: hoy,       from: 13, to: 21, label: 'tarde',  sub: dias[hoy.getDay()],       uvi: uviHoy       },
                { date: manana,    from: 6,  to: 13, label: 'maÃ±ana', sub: dias[manana.getDay()],    uvi: uviManana    },
                { date: manana,    from: 13, to: 21, label: 'tarde',  sub: dias[manana.getDay()],    uvi: uviManana    },
                { date: pasadoman, from: 6,  to: 13, label: 'maÃ±ana', sub: dias[pasadoman.getDay()], uvi: uviPasadoman },
                { date: pasadoman, from: 13, to: 21, label: 'tarde',  sub: dias[pasadoman.getDay()], uvi: uviPasadoman },
            ];

            // Filtrar las ya pasadas y coger las primeras 4 vigentes
            const franjas = todasFranjas
                .filter(f => { const fin = new Date(f.date); fin.setHours(f.to, 0, 0, 0); return fin > now; })
                .slice(0, 4);

            franjas.forEach(f => renderStrip(f.label, f.sub, getSlots(f.date, f.from, f.to), false, f.uvi));

            // â”€â”€ Leyenda calidad del baÃ±o â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            const leyenda = document.createElement('div');
            leyenda.style.cssText = 'padding:10px 14px 12px;background:#f0f8ff;border-top:1px solid #dbeaf5;font-size:11px;color:#64748b;line-height:1.8;';
            leyenda.innerHTML = `<strong style="color:#2c3e50;">* Calidad del baÃ±o:</strong> se valoran conjuntamente oleaje (altura e intensidad), viento (velocidad), temperatura del agua e Ã­ndice UV.`;
            container.appendChild(leyenda);
        }

        async function loadWeatherData() {
            try {
                const url=`https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m,precipitation,pressure_msl,cloud_cover&hourly=temperature_2m,apparent_temperature,relative_humidity_2m,pressure_msl,precipitation_probability,precipitation,weather_code,wind_speed_10m,wind_direction_10m,uv_index,cloud_cover,cloud_cover_low,cloud_cover_mid,cloud_cover_high&daily=weather_code,temperature_2m_max,temperature_2m_min,sunrise,sunset,uv_index_max&timezone=Europe/Madrid&forecast_days=7`;
                const aqUrl=`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${LAT}&longitude=${LON}&current=european_aqi,pm10,pm2_5,carbon_monoxide,nitrogen_dioxide,sulphur_dioxide,ozone,alder_pollen,birch_pollen,grass_pollen,mugwort_pollen,olive_pollen,ragweed_pollen&timezone=Europe/Madrid`;
                const marineUrl=`https://marine-api.open-meteo.com/v1/marine?latitude=${LAT}&longitude=${LON}&current=wave_height,wave_direction,wave_period,sea_surface_temperature,wind_wave_height,wind_wave_direction&hourly=wave_height,wave_period,wave_direction,wind_wave_height,wind_speed_10m,wind_direction_10m,sea_surface_temperature&timezone=Europe/Madrid&forecast_days=4`;
                const [res, aqRes, marineRes] = await Promise.all([fetch(url), fetch(aqUrl), fetch(marineUrl)]);
                const data = await res.json();
                const aqData = await aqRes.json();
                const marineData = await marineRes.json();
                if (data.daily?.sunrise && data.daily?.sunset) { sunriseTime=data.daily.sunrise[0]; sunsetTime=data.daily.sunset[0]; }
                const now=new Date(); let precipToday=0;
                if (data.hourly?.precipitation && data.hourly?.time) {
                    for(let i=0;i<data.hourly.time.length;i++){
                        const ht=new Date(data.hourly.time[i]);
                        if(ht.getDate()===now.getDate()&&ht.getMonth()===now.getMonth()&&ht<=now) precipToday+=data.hourly.precipitation[i]||0;
                    }
                }
                updateCurrentWeather(data.current, data.current.weather_code, precipToday, data.hourly);
                updateTodayTable(data.daily, data.hourly);
                updateAirQualityTable(aqData.current);
                updatePlayasTable(marineData.current, data.daily, marineData.hourly, data.hourly);
                updateRainTable(data.hourly, data.daily);
                updateDaysTable(data.hourly, data.daily);
                updateDaysSummary(data.hourly, data.daily);
                updateTime();
            } catch(e) { console.error('Error al cargar datos:',e); }
        }

        function updateCurrentWeather(current, weatherCode, precipToday, hourly) {
            const now=new Date();
            document.getElementById('current-temp').textContent=Math.round(current.temperature_2m)+'Â°';
            document.getElementById('current-icon').innerHTML=getWeatherIcon(weatherCode,now,{cloud_cover:current.cloud_cover});
            document.getElementById('pressure').textContent=Math.round(current.pressure_msl)+' hPa';
            document.getElementById('humidity').textContent=current.relative_humidity_2m+'%';
            document.getElementById('wind').textContent=Math.round(current.wind_speed_10m)+' km/h';
            document.getElementById('precip-today').textContent=(precipToday||0).toFixed(1)+' mm';
            if (hourly?.time && hourly?.uv_index) {
                const idx=hourly.time.findIndex(t=>Math.abs(new Date(t)-now)<30*60*1000);
                if (idx!==-1&&hourly.uv_index[idx]!==undefined) {
                    const el=document.getElementById('uvi-current');
                    el.textContent=hourly.uv_index[idx].toFixed(1); el.style.color='#2C3E50';
                }
            }
        }

        function updateWeatherTable(hourly) {
            const tbody=document.getElementById('weather-table-body'); tbody.innerHTML='';
            const now=new Date();
            for(let i=1;i<=11;i++){
                const target=new Date(now.getTime()+i*2*3600000);
                const idx=hourly.time.findIndex(t=>Math.abs(new Date(t)-target)<3600000);
                if(idx===-1) continue;
                const ht=new Date(hourly.time[idx]);
                const cd={cloud_cover:hourly.cloud_cover?.[idx],cloud_cover_low:hourly.cloud_cover_low?.[idx],cloud_cover_mid:hourly.cloud_cover_mid?.[idx]};
                const row=document.createElement('tr');
                row.innerHTML=`<td class="table-hour">${formatHour(hourly.time[idx])}</td><td class="table-icon">${getWeatherIcon(hourly.weather_code[idx],ht,cd)}</td><td class="table-temp">${Math.round(hourly.temperature_2m[idx])}Â°C</td><td class="table-rain">${(hourly.precipitation?.[idx]||0).toFixed(1)} mm</td><td class="table-wind">${Math.round(hourly.wind_speed_10m[idx])} km/h</td>`;
                tbody.appendChild(row);
            }
        }

        function getWindDir(deg) { return['N','NE','E','SE','S','SO','O','NO'][Math.round(deg/45)%8]; }

        const SKY_IMG="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQACWAJYAAD/2wCEAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDIBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMv/CABEIA9QFpAMBIgACEQEDEQH/xAAyAAEBAQEBAQEBAAAAAAAAAAAAAQIFBAYDBwEBAQEBAQEAAAAAAAAAAAAAAAECBAMF/9oADAMBAAIQAxAAAAD+ij6nyAAAAFlgAAoAABaCgCAKAFUAFlBZQKACiLZQAAMKIAoAKBZRZRZQAABZRZSgAABaGwKACgWUAWUCAUACgoAKAFCAKACiUABZQBZQAAAAFogAAIDAAAAAAAD50fQ5AAAgBQAWUAABVlAKIAAoAVQAUFllWUAFBYWUAAFyCCoAKAFBZRZQAABQWUoAAAWhsCgAoFlAFlAgFAAoKACgBQgCgAolAAWUAAAoAAAWiAAAAyCAgAAAAD50fQ5AABYAAAWUABQFACiAFAFAoKABSFlUCgWWFlAAFgowWIoKgoKUlBZQABZRZQCgAAFaBoUAAoFlAFlAAlAWUAoAKAFCAKACiUABZQAACgAABalgAAAAIDIIAAAA+dV38kUSgAAKSgACigBRKQABQoCgKACgSrKAUCywsoAABRgEUAFBbKALKAALKLKAUAKBQ2UAACgCygCygAKELKAUAFAChAFABRKAAsoAABQAAAoFRFAAAAEBAQAAEfPDv5AAACgAAFAWUWUACBSUAVZQCgAogFWUWUAWWFlAAFIFylIAUBRZQBZQABQWUAoUGhUBqgAFAAFlAFlAAUIWUAoAKAFCAKACiUABZUAABaAAAFACKAAAAAAAAMgPnh28oApKIAACgCkoCgBUAAoCgAoCwC0AoAEKCygAFGFEAAUFAsoAsoAsoAsoKAoNUKBQAUAACygCygAKELKAUAFQUKEAUAFEoAFCAAAtAAACgBFAAAAAAAAAB88rr5YoAAFIoiiKACgUlAIAFUAUAKgFWUAoFlgUiiUBcpQFyAFAFlAFlAFABQAUBVBoFoAKACgAAWUAWUABQhZQCgAAoUIAoAKJQAKlAAQFoAAAAUCpYAAAAAAAAA+fV18sURRFAAoBFABQEAAAtAoAAVLKAsosoAssLKAALBRgsRQVKAUCgKSgAsoAsoKAoNAtABQAUAACygCygAKEKAFAAAsFEoFABRKAAsoAABQAAAAAoCxFAAAAAAABwB18oBRAKAAAsSgAAKsURQBQAKQCqCgLAEoLKACwGQoECgBQBQLKAAKACgsoCg0C0AFABQAKAACygKLEoAAUAAAFEAtABRKAAsoAABQAAAAAoAFEAAAAAAAcEdfKAAEAoBQAAAUAAAqgEKAAFKAKQsoAAKBgpAAFAoCkoALKALKALKAUKDQKUCkoAAUAoAClAAQsoAsoAAAAsoApAKBRKACLKAoAAAFAAAAAC1BRAAAAAAHBHXzABCgAAAAKAAACgKVAAApLRKCkCkoAALLksuQABQBQUAACgAoCkoCgNgqgBQAAAUCygCygAASrKALKAAAAAUCxFCigSgAiygKAAABQAAAAAoAAQBUoAABwVdXNFEoFEURQBKAABURVpUSgAAULKCwAKAAAFZBCkAKACgBQAKApKACyiyqADQLQAUAAAoAsoAsoAAEqygCygAAAAFAEUKsoCgAiywCggAKBUFQUAAAKAAAABUFRFQcMdXMKSgAAAoRYtAVEoACkKALKAKQAAsoAEKZCgQKACgBQAABQLKAAKNLKoKAsoKAAAKAACygCygAASrKALKAAAAAUARQqwUAKCLLAKCAAAoAFAAAAACgAAAAAcNp0c+WhloZtBRFEUSgAAmhKAApKApKQAAKBkUBAsAKApKAoAAAKAFAAoAUA2CgLKUAAAFABQAALKoIChCygCygAAAAFAEUKAAsoCrKgAAQAAKsWFAAAAAAAAAAABxh0eAAAApFEURQLEURRFEVQQoACkVEpBVSmQsSgKSgKACgAABQAoAALKqyqCA0KsUShQAAFAAFAACrKAABCygCygAAAAFAEUKAAsoAAAsoCggRQAqUQFAAAAAAAAABxx0eCURRKAAACkCkURRFEUSgKSkBkURQApACgAoAACgAoAKSgACqNAqgAAsoKRQAACrKgAoACgKAAsRRKACygAAAAFAEUKAAsACygCygKACUQCgAAAAAAAAAAAcdXv4RRFEUSgURRFAAABRKAZCxFEVAApKAoAKAAAFACgAAsFAK1KKKsoAACgCygAAALQigACgKICgLLAApFEoAAAACgARQoAAACygCw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";
        function uviLevel(v) {
            const n = Math.round(v);
            if (n <= 2)  return { lbl: 'Bajo',        color: '#4caf50' };
            if (n <= 5)  return { lbl: 'Moderado',    color: '#ffb300' };
            if (n <= 7)  return { lbl: 'Alto',         color: '#ff7043' };
            if (n <= 10) return { lbl: 'Muy alto',     color: '#e53935' };
            return              { lbl: 'Extremo',      color: '#9c27b0' };
        }

        function getSkyGradient(wmoCode) {
            if(wmoCode===0||wmoCode===1)
                return 'linear-gradient(160deg,#1a6fc4 0%,#56a0e0 45%,#ffd97a 100%)';
            if(wmoCode===2)
                return 'linear-gradient(160deg,#4a7ab5 0%,#8ab4d8 50%,#c9d8e8 100%)';
            if(wmoCode===3)
                return 'linear-gradient(160deg,#6b7f96 0%,#9bafc4 60%,#c5cfd8 100%)';
            if(wmoCode===45||wmoCode===48)
                return 'linear-gradient(160deg,#8e9aaa 0%,#b5bec8 60%,#dde2e7 100%)';
            if((wmoCode>=51&&wmoCode<=67)||(wmoCode>=80&&wmoCode<=82))
                return 'linear-gradient(160deg,#3d5a7a 0%,#607a94 50%,#90a8bc 100%)';
            if(wmoCode>=71&&wmoCode<=77)
                return 'linear-gradient(160deg,#7a8fa0 0%,#b0c4d4 50%,#ddeaf3 100%)';
            if(wmoCode>=95)
                return 'linear-gradient(160deg,#2a3444 0%,#4a5568 50%,#6b7a8d 100%)';
            return 'linear-gradient(160deg,#4a7ab5 0%,#7aaad0 60%,#b0d0e8 100%)';
        }

        function buildExpandableDay(hourly, daily, off, container) {
            if(daily.temperature_2m_min[off]===undefined||daily.temperature_2m_max[off]===undefined) return;
            const now=new Date();
            const tDay=new Date(now); tDay.setDate(tDay.getDate()+off); tDay.setHours(0,0,0,0);
            const dn=getDayName(tDay.toISOString());
            const MESES=['ene','feb','mar','abr','may','jun','jul','ago','sep','oct','nov','dic'];
            const fechaStr=tDay.getDate()+' '+MESES[tDay.getMonth()];

            // Icono representativo (hora 12)
            let h12=-1;
            for(let i=0;i<hourly.time.length;i++){const ht=new Date(hourly.time[i]);if(ht.getDate()===tDay.getDate()&&ht.getMonth()===tDay.getMonth()&&ht.getHours()===12){h12=i;break;}}
            const mc=h12!==-1?hourly.weather_code[h12]:(daily.weather_code?.[off]||0);
            const cdMain=h12!==-1?{cloud_cover:hourly.cloud_cover?.[h12],cloud_cover_low:hourly.cloud_cover_low?.[h12],cloud_cover_mid:hourly.cloud_cover_mid?.[h12]}:null;
            const icon=getWeatherIcon(mc,h12!==-1?new Date(hourly.time[h12]):tDay,cdMain);
            const minT=Math.round(daily.temperature_2m_min[off]),maxT=Math.round(daily.temperature_2m_max[off]);

            // Totales del dÃ­a
            const tDayStr=daily.time[off]; // "YYYY-MM-DD" â€” fuente de verdad
            let tp=0,ws=[],wd=[],rainHours=[];
            for(let i=0;i<hourly.time.length;i++){
                if(!hourly.time[i].startsWith(tDayStr)) continue;
                const pr=hourly.precipitation[i]||0;
                tp+=pr;
                if(pr>0) rainHours.push(parseInt(hourly.time[i].slice(11,13),10));
                if(hourly.wind_speed_10m)ws.push(hourly.wind_speed_10m[i]);
                if(hourly.wind_direction_10m)wd.push(hourly.wind_direction_10m[i]);
            }
            tp=Math.round(tp*10)/10;
            const aw=ws.length>0?Math.round(ws.reduce((a,b)=>a+b,0)/ws.length):0;
            const awd=wd.length>0?Math.round(wd.reduce((a,b)=>a+b,0)/wd.length):0;
            function groupRainHours(hours){
                if(!hours.length) return '';
                const ranges=[];
                let s=hours[0],e=hours[0];
                for(let k=1;k<hours.length;k++){
                    if(hours[k]===e+1){e=hours[k];}
                    else{ranges.push(s===e?String(s).padStart(2,'0')+':00h':String(s).padStart(2,'0')+':00-'+String(e+1).padStart(2,'0')+':00h');s=e=hours[k];}
                }
                ranges.push(s===e?String(s).padStart(2,'0')+':00h':String(s).padStart(2,'0')+':00-'+String(e+1).padStart(2,'0')+':00h');
                return ' ('+ranges.join(', ')+')';
            }
            const rainHoursStr=groupRainHours(rainHours);

            // Amanecer/atardecer y UVI
            const sr=daily.sunrise?.[off]?new Date(daily.sunrise[off]).toLocaleTimeString('es-ES',{hour:'2-digit',minute:'2-digit'}):'--:--';
            const ss=daily.sunset?.[off]?new Date(daily.sunset[off]).toLocaleTimeString('es-ES',{hour:'2-digit',minute:'2-digit'}):'--:--';
            const uv=daily.uv_index_max?.[off]!==undefined?Math.round(daily.uv_index_max[off]*10)/10:'--';

            // Datos horarios 08, 12, 16, 20
            let hIdx={8:-1,12:-1,16:-1,20:-1};
            for(let i=0;i<hourly.time.length;i++){
                const ht=new Date(hourly.time[i]);
                if(ht.getDate()===tDay.getDate()&&ht.getMonth()===tDay.getMonth()){
                    const hr=ht.getHours();
                    if(hr===8&&hIdx[8]===-1)hIdx[8]=i;
                    if(hr===12&&hIdx[12]===-1)hIdx[12]=i;
                    if(hr===16&&hIdx[16]===-1)hIdx[16]=i;
                    if(hr===20&&hIdx[20]===-1)hIdx[20]=i;
                }
            }
            const hrs=[8,12,16,20];
            const labels=['08:00','12:00','16:00','20:00'];
            function cdHr(idx){return idx!==-1?{cloud_cover:hourly.cloud_cover?.[idx],cloud_cover_low:hourly.cloud_cover_low?.[idx],cloud_cover_mid:hourly.cloud_cover_mid?.[idx]}:null;}
            const icons4=hrs.map(hr=>hIdx[hr]!==-1?getWeatherIcon(hourly.weather_code[hIdx[hr]],new Date(hourly.time[hIdx[hr]]),cdHr(hIdx[hr])):'â€”');
            const temps4=hrs.map(hr=>hIdx[hr]!==-1?Math.round(hourly.temperature_2m[hIdx[hr]])+'Â°C':'--');
            const hum4=hrs.map(hr=>hIdx[hr]!==-1&&hourly.relative_humidity_2m?hourly.relative_humidity_2m[hIdx[hr]]+'%':'--');
            const pres4=hrs.map(hr=>{
                const i=hIdx[hr]; if(i===-1)return'--';
                const p=hourly.pressure_msl?.[i];
                return p?Math.round(p)+' hPa':'--';
            });
            const rain4=hrs.map(hr=>hIdx[hr]!==-1?(hourly.precipitation?.[hIdx[hr]]||0).toFixed(1)+' mm':'--');
            const feels4=hrs.map(hr=>hIdx[hr]!==-1&&hourly.apparent_temperature?Math.round(hourly.apparent_temperature[hIdx[hr]])+'Â°C':'--');
            const wind4=hrs.map(hr=>hIdx[hr]!==-1?Math.round(hourly.wind_speed_10m?.[hIdx[hr]]||0)+' km/h':'--');
            const wdir4=hrs.map(hr=>hIdx[hr]!==-1&&hourly.wind_direction_10m?getWindDir(hourly.wind_direction_10m[hIdx[hr]]):'--');

            // Wrapper
            const wrap=document.createElement('div');
            wrap.style.cssText='margin-bottom:0;border-bottom:1px solid #e9ecef;';

            const skyBg=getSkyGradient(mc);

            const HEADER_BG=`url("${SKY_IMG}") center/cover no-repeat`;

            // Cabecera clicable
            const head=document.createElement('div');
            head.style.cssText='display:flex;align-items:center;justify-content:space-between;padding:18px 14px;cursor:pointer;background:#fff;user-select:none;transition:background 0.4s;';
            head.innerHTML=`
                <div style="display:flex;align-items:center;gap:12px;">
                    <div class="day-head-icon" style="font-size:42px;line-height:1;">${icon}</div>
                    <div>
                        <div class="day-head-title" style="font-size:19px;font-weight:700;color:#2C3E50;transition:color 0.4s;letter-spacing:0.5px;">${dn.toUpperCase()} <span class="day-head-date" style="font-size:14px;font-weight:400;color:#94A3B8;transition:color 0.4s;">${fechaStr}</span></div>
                        <div class="day-head-meta" style="font-size:13px;color:#64748B;margin-top:5px;line-height:1.7;transition:color 0.4s;">
                            <span class="day-temp-min" style="color:#3B82F6;font-weight:700;font-size:22px;transition:color 0.4s;">${minT}Â°</span>
                            <span class="day-sep" style="margin:0 4px;opacity:0.4;">/</span>
                            <span class="day-temp-max" style="color:#EF4444;font-weight:700;font-size:22px;transition:color 0.4s;">${maxT}Â°</span>
                            <span class="day-sep" style="margin:0 5px;opacity:0.4;">|</span>
                            <span class="day-rain-lbl" style="transition:color 0.4s;">Lluvia prevista: ${tp} mm${rainHoursStr}</span>
                            <span class="day-sep" style="margin:0 5px;opacity:0.4;">|</span>
                            <span class="day-wind-lbl" style="transition:color 0.4s;">${aw} km/h ${getWindDir(awd)}</span>
                            <br>
                            <span class="day-sol-lbl" style="font-size:11px;transition:color 0.4s;">SOL: ${sr} / ${ss}</span>
                            <span class="day-sep" style="margin:0 5px;opacity:0.4;">|</span>
                            <span class="day-uvi-lbl" style="font-size:11px;transition:color 0.4s;">UVI ${Math.round(uv)} (${uviLevel(uv).lbl})</span>
                        </div>
                    </div>
                </div>
                <div class="ds-arrow" style="font-size:12px;color:#94A3B8;transition:transform 0.3s,color 0.4s;flex-shrink:0;">â–¼</div>`;

            // Contenido desplegable
            const body=document.createElement('div');
            body.style.cssText=`display:none;overflow:hidden;background:url("${SKY_IMG}") center/cover no-repeat;`;

            // Helper: celda con etiqueta solo en col 0
            function cell(j, label, value, extra='') {
                const lbl = j===0 ? `<div style="font-size:10px;color:#94A3B8;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:2px;">${label}</div>` : '';
                return `<td style="text-align:center;padding:5px 4px;">${lbl}<div style="font-size:${label==='Temp.'?'15px':'13px'};font-weight:${label==='Temp.'?'700':'600'};color:#2C3E50;">${value}</div>${extra}</td>`;
            }

            body.innerHTML=`
            <table style="width:100%;border-collapse:collapse;background:transparent;">
            <thead>
              <tr style="background:rgba(20,50,80,0.82);">
                ${labels.map(l=>`<th style="padding:11px 4px;color:#fff;font-size:14px;font-weight:700;text-align:center;letter-spacing:0.5px;">${l}</th>`).join('')}
              </tr>
            </thead>
            <tbody>
              <!-- ICONOS -->
              <tr style="background:rgba(255,255,255,0.18);">
                ${[0,1,2,3].map(j=>`<td style="text-align:center;padding:14px 4px 8px;font-size:34px;line-height:1;">${icons4[j]}</td>`).join('')}
              </tr>
              <!-- TEMPERATURA -->
              <tr style="background:rgba(255,255,255,0.40);">
                ${[0,1,2,3].map(j=>`<td style="text-align:center;padding:2px 4px 8px;"><div style="font-size:16px;font-weight:700;color:#1a2e44;">${temps4[j]}</div></td>`).join('')}
              </tr>
              <!-- SENSACION -->
              <tr style="background:rgba(255,255,255,0.55);">
                <td colspan="4" style="text-align:center;padding:6px 4px 2px;">
                  <div style="font-size:10px;font-weight:700;color:#546e7a;text-transform:uppercase;letter-spacing:1px;">SensaciÃ³n</div>
                </td>
              </tr>
              <tr style="background:rgba(255,255,255,0.40);">
                ${[0,1,2,3].map(j=>`<td style="text-align:center;padding:2px 4px 8px;"><div style="font-size:15px;font-weight:600;color:#1a2e44;">${feels4[j]}</div></td>`).join('')}
              </tr>
              <!-- HUMEDAD -->
              <tr style="background:rgba(255,255,255,0.55);">
                <td colspan="4" style="text-align:center;padding:6px 4px 2px;">
                  <div style="font-size:10px;font-weight:700;color:#546e7a;text-transform:uppercase;letter-spacing:1px;">Humedad</div>
                </td>
              </tr>
              <tr style="background:rgba(255,255,255,0.40);">
                ${[0,1,2,3].map(j=>`<td style="text-align:center;padding:2px 4px 8px;"><div style="font-size:15px;font-weight:600;color:#1a2e44;">${hum4[j]}</div></td>`).join('')}
              </tr>
              <!-- PRESION -->
              <tr style="background:rgba(255,255,255,0.55);">
                <td colspan="4" style="text-align:center;padding:6px 4px 2px;">
                  <div style="font-size:10px;font-weight:700;color:#546e7a;text-transform:uppercase;letter-spacing:1px;">PresiÃ³n</div>
                </td>
              </tr>
              <tr style="background:rgba(255,255,255,0.40);">
                ${[0,1,2,3].map(j=>`<td style="text-align:center;padding:2px 4px 8px;"><div style="font-size:14px;font-weight:600;color:#1a2e44;">${pres4[j]}</div></td>`).join('')}
              </tr>
              <!-- VIENTO -->
              <tr style="background:rgba(255,255,255,0.55);">
                <td colspan="4" style="text-align:center;padding:6px 4px 2px;">
                  <div style="font-size:10px;font-weight:700;color:#546e7a;text-transform:uppercase;letter-spacing:1px;">Viento</div>
                </td>
              </tr>
              <tr style="background:rgba(255,255,255,0.40);">
                ${[0,1,2,3].map(j=>`<td style="text-align:center;padding:2px 4px 12px;">
                  <div style="font-size:15px;font-weight:700;color:#1a2e44;">${wind4[j]}</div>
                  <div style="font-size:12px;color:#546e7a;margin-top:1px;">${wdir4[j]}</div>
                </td>`).join('')}
              </tr>
            </tbody>
            </table>`;

            head.addEventListener('click',function(){
                const isOpen=body.style.display!=='none';
                body.style.display=isOpen?'none':'block';
                head.querySelector('.ds-arrow').style.transform=isOpen?'rotate(0deg)':'rotate(180deg)';
                if(!isOpen){
                    head.style.background=HEADER_BG;
                    head.querySelector('.day-head-title').style.color='#1a2e44';
                    head.querySelector('.day-head-date').style.color='rgba(20,50,80,0.7)';
                    head.querySelector('.day-head-meta').style.color='rgba(20,50,80,0.85)';
                    head.querySelector('.day-temp-min').style.color='#1a5a9a';
                    head.querySelector('.day-temp-max').style.color='#c05000';
                    head.querySelector('.day-rain-lbl').style.color='rgba(20,50,80,0.85)';
                    head.querySelector('.day-wind-lbl').style.color='rgba(20,50,80,0.85)';
                    head.querySelector('.day-sol-lbl').style.color='rgba(20,50,80,0.85)';
                    head.querySelector('.day-uvi-lbl').style.color='rgba(20,50,80,0.85)';
                    head.querySelector('.ds-arrow').style.color='rgba(20,50,80,0.6)';
                    head.querySelectorAll('.day-sep').forEach(s=>s.style.color='rgba(20,50,80,0.25)');
                } else {
                    head.style.background='#fff';
                    head.querySelector('.day-head-title').style.color='#2C3E50';
                    head.querySelector('.day-head-date').style.color='#94A3B8';
                    head.querySelector('.day-head-meta').style.color='#64748B';
                    head.querySelector('.day-temp-min').style.color='#3B82F6';
                    head.querySelector('.day-temp-max').style.color='#EF4444';
                    head.querySelector('.day-rain-lbl').style.color='#64748B';
                    head.querySelector('.day-wind-lbl').style.color='#64748B';
                    head.querySelector('.day-sol-lbl').style.color='#64748B';
                    head.querySelector('.day-uvi-lbl').style.color='#64748B';
                    head.querySelector('.ds-arrow').style.color='#94A3B8';
                    head.querySelectorAll('.day-sep').forEach(s=>s.style.color='#ccc');
                }
            });

            wrap.appendChild(head);
            wrap.appendChild(body);
            container.appendChild(wrap);
        }

        function updateRainTable(hourly, daily) {
            const container = document.getElementById('rain-7days-container');
            if (!container || !daily?.time) return;
            const DIAS = ['Dom','Lun','Mar','MiÃ©','Jue','Vie','SÃ¡b'];
            const MESES = ['ene','feb','mar','abr','may','jun','jul','ago','sep','oct','nov','dic'];

            function groupRainHours(hours) {
                if (!hours.length) return '';
                const ranges = [];
                let s = hours[0], e = hours[0];
                for (let k = 1; k < hours.length; k++) {
                    if (hours[k] === e + 1) { e = hours[k]; }
                    else {
                        ranges.push(s === e
                            ? String(s).padStart(2,'0') + 'h'
                            : String(s).padStart(2,'0') + '-' + String(e+1).padStart(2,'0') + 'h');
                        s = e = hours[k];
                    }
                }
                ranges.push(s === e
                    ? String(s).padStart(2,'0') + 'h'
                    : String(s).padStart(2,'0') + '-' + String(e+1).padStart(2,'0') + 'h');
                return ranges.join(', ');
            }

            // Construir filas: dÃ­a 0 (hoy) hasta dÃ­a 6
            const rows = [];
            let totalAcum = 0;
            for (let off = 0; off < 7; off++) {
                const dateStr = daily.time[off];
                if (!dateStr) continue;
                const d = new Date(dateStr + 'T12:00:00');
                const diaNom = DIAS[d.getDay()];
                const fechaLabel = d.getDate() + ' ' + MESES[d.getMonth()];

                let tp = 0, rainHours = [];
                for (let i = 0; i < hourly.time.length; i++) {
                    if (!hourly.time[i].startsWith(dateStr)) continue;
                    const pr = hourly.precipitation[i] || 0;
                    tp += pr;
                    if (pr > 0) rainHours.push(parseInt(hourly.time[i].slice(11,13), 10));
                }
                tp = Math.round(tp * 10) / 10;
                totalAcum += tp;

                const horasStr = groupRainHours(rainHours);
                const hasRain = tp > 0;

                rows.push({ diaNom, fechaLabel, tp, horasStr, hasRain, isToday: off === 0 });
            }
            totalAcum = Math.round(totalAcum * 10) / 10;

            // Escala dinÃ¡mica: mÃ¡ximo real redondeado al mÃºltiplo de 5 superior (mÃ­nimo 10mm)
            const maxTp = Math.max(...rows.map(r => r.tp), 0);
            const scaleMax = Math.max(10, Math.ceil(maxTp / 5) * 5);

            // Calcular barras y colores ahora que tenemos la escala
            rows.forEach(r => {
                r.barPct = scaleMax > 0 ? Math.min(r.tp / scaleMax * 100, 100) : 0;
                r.barColor = r.tp === 0 ? '#e2e8f0'
                    : r.tp < 2   ? '#93c5fd'
                    : r.tp < 8   ? '#3b82f6'
                    : r.tp < 15  ? '#1d4ed8'
                    : '#7c3aed';
            });

            let html = `
            <div class="rain-header-bg" style="padding:0 10px;text-align:center;color:#fff;font-size:14px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;">
                PrecipitaciÃ³n â€” PrÃ³ximos 7 dÃ­as
            </div>
            <div style="border:1px solid #e2e8f0;border-top:none;background:#fff;overflow:hidden;">
                <table style="width:100%;border-collapse:collapse;">
                    <thead>
                        <tr style="background:#f1f5f9;">
                            <th style="padding:10px 12px;text-align:left;font-size:11px;font-weight:700;color:#64748b;text-transform:uppercase;letter-spacing:0.8px;width:38%;">DÃ­a</th>
                            <th style="padding:10px 8px;text-align:center;font-size:11px;font-weight:700;color:#64748b;text-transform:uppercase;letter-spacing:0.8px;width:16%;">Total</th>
                            <th style="padding:10px 8px;text-align:left;font-size:11px;font-weight:700;color:#64748b;text-transform:uppercase;letter-spacing:0.8px;">Horas con lluvia</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            rows.forEach((r, idx) => {
                const bg = r.isToday ? 'background:#f8faff;' : (idx % 2 === 0 ? '' : 'background:#fafafa;');
                const todayMark = r.isToday ? '<span style="font-size:9px;background:#3b82f6;color:#fff;padding:1px 5px;border-radius:3px;margin-left:5px;vertical-align:middle;">HOY</span>' : '';
                const mmColor = r.tp === 0 ? '#94a3b8' : r.tp < 5 ? '#3b82f6' : r.tp < 15 ? '#1d4ed8' : '#7c3aed';
                const horasCell = r.hasRain
                    ? `<span style="font-size:12px;color:#1e293b;font-weight:500;">${r.horasStr}</span>`
                    : `<span style="font-size:12px;color:#94a3b8;font-style:italic;">Sin lluvia</span>`;

                html += `
                <tr style="${bg}border-bottom:1px solid #f1f5f9;">
                    <td style="padding:11px 12px;">
                        <div style="font-size:14px;font-weight:700;color:#2c3e50;">${r.diaNom} <span style="font-weight:400;color:#64748b;">${r.fechaLabel}</span>${todayMark}</div>
                        <div style="margin-top:5px;height:5px;background:#e2e8f0;border-radius:3px;overflow:hidden;">
                            <div style="height:100%;width:${r.barPct}%;background:${r.barColor};border-radius:3px;transition:width 0.8s ease;"></div>
                        </div>
                    </td>
                    <td style="padding:11px 8px;text-align:center;">
                        <div style="font-size:16px;font-weight:800;color:${mmColor};">${r.tp > 0 ? r.tp : 'â€”'}</div>
                        ${r.tp > 0 ? '<div style="font-size:10px;color:#94a3b8;margin-top:1px;">mm</div>' : ''}
                    </td>
                    <td style="padding:11px 8px;">${horasCell}</td>
                </tr>`;
            });

            html += `
                    </tbody>
                </table>
            </div>`;

            container.innerHTML = html;
        }

        function updateDaysTable(hourly, daily) {
            const container=document.getElementById('days-detailed-container'); container.innerHTML='';
            // TÃ­tulo de secciÃ³n
            const title=document.createElement('div');
            title.className = 'rain-header-bg';
            title.style.cssText='padding:0 10px;text-align:center;color:#fff;font-size:14px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;';
            title.textContent='PrevisiÃ³n prÃ³ximos 7 dÃ­as';
            container.appendChild(title);
            // Wrapper con borde
            const box=document.createElement('div');
            box.style.cssText='border:1px solid #e9ecef;border-top:none;background:#fff;';
            for(let off=1;off<=6;off++){
                buildExpandableDay(hourly, daily, off, box);
            }
            container.appendChild(box);
        }

        function updateDaysSummary(hourly, daily) {
            // Ahora vacÃ­o â€” los dÃ­as 5-7 ya se muestran en updateDaysTable
            const container=document.getElementById('days-summary-container');
            if(container) container.innerHTML='';
        }

        function updateTime() {
            const now=new Date();
            const meses=['enero','febrero','marzo','abril','mayo','junio','julio','agosto','septiembre','octubre','noviembre','diciembre'];
            document.getElementById('update-time').textContent='Actualizado: '+now.getDate()+' de '+meses[now.getMonth()]+' de '+now.getFullYear();
        }

        loadWeatherData();
        setInterval(loadWeatherData, 600000);

        /* â•â•â•â•â•â• WIDGET PREVISIÃ“N 3 DÃAS â•â•â•â•â•â• */
        (function(){
          const DAYS_ES=['domingo','lunes','martes','miÃ©rcoles','jueves','viernes','sÃ¡bado'];
          const MONTHS_ES=['ene','feb','mar','abr','may','jun','jul','ago','sep','oct','nov','dic'];
          const WMO={
            0:{e:'â˜€ï¸',l:'Despejado'},1:{e:'ğŸŒ¤ï¸',l:'Mayormente despejado'},
            2:{e:'â›…',l:'Parcialmente nublado'},3:{e:'â˜ï¸',l:'Nublado'},
            45:{e:'ğŸŒ«ï¸',l:'Niebla'},48:{e:'ğŸŒ«ï¸',l:'Niebla con escarcha'},
            51:{e:'ğŸŒ¦ï¸',l:'Llovizna ligera'},53:{e:'ğŸŒ¦ï¸',l:'Llovizna'},55:{e:'ğŸŒ§ï¸',l:'Llovizna intensa'},
            61:{e:'ğŸŒ§ï¸',l:'Lluvia ligera'},63:{e:'ğŸŒ§ï¸',l:'Lluvia moderada'},65:{e:'ğŸŒ§ï¸',l:'Lluvia intensa'},
            71:{e:'ğŸŒ¨ï¸',l:'Nieve ligera'},80:{e:'ğŸŒ¦ï¸',l:'Chubascos ligeros'},
            81:{e:'ğŸŒ§ï¸',l:'Chubascos moderados'},82:{e:'â›ˆï¸',l:'Chubascos fuertes'},
            95:{e:'â›ˆï¸',l:'Tormenta'},99:{e:'â›ˆï¸',l:'Tormenta con granizo'}
          };
          function wmo(c){return WMO[c]||{e:'ğŸŒ¡ï¸',l:'Variable'};}
          function windDir(d){return['N','NNE','NE','ENE','E','ESE','SE','SSE','S','SSO','SO','OSO','O','ONO','NO','NNO'][Math.round(d/22.5)%16];}
          function windLbl(s){if(s<10)return'Calma';if(s<20)return'Brisa suave';if(s<35)return'Viento moderado';if(s<50)return'Viento fuerte';return'Viento muy fuerte';}
          function seaLbl(s){if(s<10)return{l:'Mar en calma',o:'< 0.5m'};if(s<20)return{l:'Mar rizada',o:'0.5â€“1m'};if(s<35)return{l:'Mar moderada',o:'1â€“1.5m'};if(s<50)return{l:'Mar agitada',o:'1.5â€“2.5m'};return{l:'Mar gruesa',o:'> 2.5m'};}

          function bcnMap(){
            return `<svg style="position:absolute;top:6px;left:50%;transform:translateX(-50%);width:90%;z-index:2;" viewBox="0 0 320 185" xmlns="http://www.w3.org/2000/svg">
              <ellipse cx="58" cy="52" rx="66" ry="40" fill="#8aac8a" opacity="0.42"/>
              <polygon points="93,8 143,8 152,44 108,49 88,30" fill="#90a4ae" stroke="#546e7a" stroke-width="0.7"/>
              <text x="100" y="30" font-size="5.5" fill="#cfd8dc" font-family="Inter,sans-serif" opacity="0.8">Nou Barris</text>
              <polygon points="143,8 192,13 197,54 152,44" fill="#8fa8b5" stroke="#546e7a" stroke-width="0.7"/>
              <text x="154" y="33" font-size="5.5" fill="#cfd8dc" font-family="Inter,sans-serif" opacity="0.8">Horta</text>
              <polygon points="152,44 197,54 202,88 162,93 148,74" fill="#92aab8" stroke="#546e7a" stroke-width="0.7"/>
              <text x="159" y="73" font-size="5" fill="#cfd8dc" font-family="Inter,sans-serif" opacity="0.8">St.Andreu</text>
              <polygon points="108,49 152,44 148,74 118,84 98,69" fill="#8da5b2" stroke="#546e7a" stroke-width="0.7"/>
              <text x="112" y="67" font-size="5.5" fill="#cfd8dc" font-family="Inter,sans-serif" opacity="0.8">GrÃ cia</text>
              <polygon points="162,93 202,88 212,132 172,142 152,120" fill="#8badb8" stroke="#546e7a" stroke-width="0.7"/>
              <text x="167" y="118" font-size="5" fill="#cfd8dc" font-family="Inter,sans-serif" opacity="0.8">St.MartÃ­</text>
              <polygon points="98,69 148,74 152,120 103,124 86,103" fill="#8fadb9" stroke="#546e7a" stroke-width="0.7"/>
              <text x="103" y="100" font-size="5.5" fill="#cfd8dc" font-family="Inter,sans-serif" opacity="0.8">Eixample</text>
              <polygon points="58,84 98,69 86,103 63,116 46,104" fill="#90a4ae" stroke="#546e7a" stroke-width="0.7"/>
              <text x="51" y="97" font-size="4.8" fill="#cfd8dc" font-family="Inter,sans-serif" opacity="0.8">Les Corts</text>
              <polygon points="38,42 108,49 98,69 58,84 28,64" fill="#8da5b0" stroke="#546e7a" stroke-width="0.7"/>
              <text x="44" y="62" font-size="4.8" fill="#cfd8dc" font-family="Inter,sans-serif" opacity="0.8">SarriÃ -S.G.</text>
              <polygon points="46,104 86,103 103,124 88,152 38,142 28,122" fill="#8fa4ae" stroke="#546e7a" stroke-width="0.7"/>
              <ellipse cx="52" cy="132" rx="18" ry="12" fill="#7a9a7a" opacity="0.48"/>
              <text x="52" y="136" font-size="4.8" fill="#cfd8dc" font-family="Inter,sans-serif" opacity="0.8">MontjuÃ¯c</text>
              <polygon points="103,124 152,120 157,150 108,155 93,143" fill="#8aaab5" stroke="#546e7a" stroke-width="0.7"/>
              <text x="102" y="141" font-size="4.8" fill="#cfd8dc" font-family="Inter,sans-serif" opacity="0.8">C.Vella/BCNeta</text>
              <polygon points="157,150 212,132 220,160 162,168" fill="#89aab4" stroke="#546e7a" stroke-width="0.7"/>
              <polyline points="28,162 88,155 108,157 157,153 212,133 230,127" fill="none" stroke="#4db6ac" stroke-width="1.8" stroke-linecap="round"/>
              <path d="M202,88 Q212,108 216,132" fill="none" stroke="#80cbc4" stroke-width="1.2" opacity="0.5"/>
            </svg>`;
          }

          function buildCard(idx, day){
            const info=wmo(day.wmo);
            const sea=seaLbl(day.wind);
            const wdir=windDir(day.winddir);
            const iconPos=[[{l:'26%',t:'10%'},{l:'52%',t:'20%'},{l:'35%',t:'42%'}],
                           [{l:'23%',t:'12%'},{l:'50%',t:'18%'},{l:'37%',t:'41%'}],
                           [{l:'28%',t:'11%'},{l:'53%',t:'22%'},{l:'33%',t:'43%'}]][idx];
            const pins=[{n:'Eixample',l:'42%',t:'34%'},{n:'St.MartÃ­',l:'60%',t:'20%'},{n:'SarriÃ ',l:'20%',t:'21%'}];
            const rainPct=Math.min(day.rain*8,100);
            const rainLbl=day.rain>10?'Â· Lluvia significativa':day.rain>0?'Â· Lluvia leve':'Â· Sin precipitaciÃ³n';
            const delays=['0s','0.12s','0.24s'];

            return `<div class="pw-card" id="pwcard${idx}" style="transition-delay:${delays[idx]}">
              <div class="pw-card-head">
                <div class="pw-day-name">${day.name}</div>
                <div class="pw-day-date">${day.date}</div>
              </div>
              <div class="pw-temps">
                <div><span class="pw-ttag pw-ttag-max">MÃX</span><span class="pw-tmax">${day.tmax}Â°</span></div>
                <div class="pw-tdiv"></div>
                <div><span class="pw-ttag pw-ttag-min">MÃN</span><span class="pw-tmin">${day.tmin}Â°</span></div>
              </div>
              <div class="pw-map">
                <div class="pw-wind-lbl">${wdir} Â· ${Math.round(day.wind)} km/h</div>
                ${bcnMap()}
                <div class="pw-sea"></div>
                <div class="pw-sea-lbl">Mar MediterrÃ¡neo</div>
                ${iconPos.map(p=>`<div class="pw-wicon" style="left:${p.l};top:${p.t}">${info.e}</div>`).join('')}
                ${pins.map(p=>`<div class="pw-pin" style="left:${p.l};top:${p.t}"><div class="pw-pin-dot"></div><div class="pw-pin-name">${p.n}</div></div>`).join('')}
              </div>
              <div class="pw-summary">
                <div class="pw-big-icon">${info.e}</div>
                <div class="pw-summary-right">
                  <div class="pw-cond-text">${info.l}</div>
                  <div class="pw-precip-row">
                    <span>ğŸ’§</span>
                    <span class="pw-precip-val">${day.rain>0?day.rain.toFixed(1)+' mm':'0 mm'}</span>
                    <span class="pw-precip-lbl">${rainLbl}</span>
                  </div>
                  <div class="pw-precip-bar-wrap"><div class="pw-precip-bar-fill" style="width:${rainPct}%"></div></div>
                </div>
              </div>
              <div class="pw-bottom">
                <div class="pw-info">
                  <svg viewBox="0 0 40 40" fill="none"><line x1="10" y1="30" x2="26" y2="10" stroke="#80cbc4" stroke-width="3" stroke-linecap="round"/><polyline points="17,8 26,10 24,19" stroke="#80cbc4" stroke-width="2.5" stroke-linejoin="round"/><line x1="5" y1="34" x2="12" y2="34" stroke="#80cbc4" stroke-width="2"/></svg>
                  <div class="pw-info-val">${windLbl(day.wind)}</div>
                  <div class="pw-info-lbl">${Math.round(day.wind)} km/h Â· ${wdir}</div>
                </div>
                <div class="pw-info">
                  <svg viewBox="0 0 50 34" fill="none"><path d="M2 14 Q9 6 16 14 Q23 22 30 14 Q37 6 44 14 Q48 18 50 14" stroke="#80cbc4" stroke-width="2.5" stroke-linecap="round"/><path d="M2 23 Q9 15 16 23 Q23 31 30 23 Q37 15 44 23" stroke="#80cbc4" stroke-width="1.8" stroke-linecap="round" opacity="0.5"/></svg>
                  <div class="pw-info-val">${sea.l}</div>
                  <div class="pw-info-lbl">Oleaje ${sea.o}</div>
                </div>
              </div>
            </div>`;
          }

          async function loadWidget(){
            const wrap=document.getElementById('prevision-widget');
            if(!wrap) return;
            try {
              const url='https://api.open-meteo.com/v1/forecast?latitude=41.3888&longitude=2.159&daily=weathercode,temperature_2m_max,temperature_2m_min,precipitation_sum,windspeed_10m_max,winddirection_10m_dominant&timezone=Europe%2FMadrid&forecast_days=3';
              const data=await(await fetch(url)).json();
              const d=data.daily;
              const days=[];
              for(let i=0;i<3;i++){
                const raw=new Date(d.time[i]+'T12:00:00');
                days.push({
                  name:DAYS_ES[raw.getDay()],
                  date:`${raw.getDate()} ${MONTHS_ES[raw.getMonth()].toUpperCase()} Â· ${raw.getFullYear()}`,
                  wmo:d.weathercode[i],
                  tmax:Math.round(d.temperature_2m_max[i]),
                  tmin:Math.round(d.temperature_2m_min[i]),
                  rain:d.precipitation_sum[i]||0,
                  wind:d.windspeed_10m_max[i],
                  winddir:d.winddirection_10m_dominant[i]
                });
              }
              wrap.innerHTML=`
                <div class="pw-title"><div class="pw-dot"></div><div class="pw-heading">PrevisiÃ³n prÃ³ximos 3 dÃ­as Â· Barcelona</div></div>
                <div class="pw-cards">${days.map((d,i)=>buildCard(i,d)).join('')}</div>`;
              requestAnimationFrame(()=>{
                document.querySelectorAll('.pw-card').forEach((c,i)=>{
                  setTimeout(()=>c.classList.add('pw-visible'),i*130);
                });
              });
            } catch(e){
              // Silently fail â€” widget simply stays hidden
              wrap.style.display='none';
            }
          }
          loadWidget();
        })();
        /* â•â•â•â•â•â• FIN WIDGET â•â•â•â•â•â• */
    </script>
</body>
</html>
